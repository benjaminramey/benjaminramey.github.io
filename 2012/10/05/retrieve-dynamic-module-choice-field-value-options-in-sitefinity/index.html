<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <title>
        
        Retrieve Dynamic Module Choice Field Value Options in Sitefinity &middot; Ben Ramey's Blog
        
    </title>

    <link rel="stylesheet" href="/assets/css/styles.css">

    <link rel="apple-touch-icon" sizes="180x180" href="">
    <link rel="icon" type="image/png" sizes="32x32" href="">
    <link rel="icon" type="image/png" sizes="16x16" href="">
    <link rel="manifest" href="">

    <link rel="alternate" type="application/atom+xml" title="Ben Ramey's Blog" href="/atom.xml">

    <!-- Begin Jekyll SEO tag v2.6.1 -->
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="Retrieve Dynamic Module Choice Field Value Options in Sitefinity" />
<meta name="author" content="Ben Ramey" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Retrieve Dynamic Module Choice Field Value Options in Sitefinity" />
<meta property="og:description" content="Retrieve Dynamic Module Choice Field Value Options in Sitefinity" />
<link rel="canonical" href="https://www.benramey.com/2012/10/05/retrieve-dynamic-module-choice-field-value-options-in-sitefinity/" />
<meta property="og:url" content="https://www.benramey.com/2012/10/05/retrieve-dynamic-module-choice-field-value-options-in-sitefinity/" />
<meta property="og:site_name" content="Ben Ramey’s Blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2012-10-05T00:00:00-05:00" />
<script type="application/ld+json">
{"@type":"BlogPosting","dateModified":"2012-10-05T00:00:00-05:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://www.benramey.com/2012/10/05/retrieve-dynamic-module-choice-field-value-options-in-sitefinity/"},"url":"https://www.benramey.com/2012/10/05/retrieve-dynamic-module-choice-field-value-options-in-sitefinity/","author":{"@type":"Person","name":"Ben Ramey"},"headline":"Retrieve Dynamic Module Choice Field Value Options in Sitefinity","description":"Retrieve Dynamic Module Choice Field Value Options in Sitefinity","datePublished":"2012-10-05T00:00:00-05:00","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

</head>


<body>
    <header>
        <div class="container">
            <div class="d-flex justify-content-between align-item-center">
                <a href="/" class="d-flex justify-content-start align-items-center mr-2" title="Home">
                    <img src="https://en.gravatar.com/userimage/738990/32d8e61848233a67f5e02dcc43be0ff8.jpeg"
                        alt="Gravatar" />
                    <span class="ml-2">Ben Ramey's Blog</span>
                </a>
                <div class="d-none d-sm-flex flex-column justify-content-around ml-2">
                    <small>Scripture, programming problems, solutions and stories.</small>
                </div>
            </div>
        </div>
    </header>

    <nav class="main">
        <div class="container d-flex justify-content-center">
            
            
            
            
            
            
            
            <a href="/archive/">Archive</a>
            
            
            
            
            
            
            
            <a href="/categories/">Categories</a>
            
            
            
            
            
            
            
            
            
            <a href="/tags/">Tags</a>
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
        </div>
    </nav>

    <main>
        <div class="container">
            <article class="post">
    <h1 class="post-title">Retrieve Dynamic Module Choice Field Value Options in Sitefinity</h1>
    <div class="post-info d-flex justify-content-start">
        <time datetime="2012-10-05T00:00:00-05:00" class="post-date">05 Oct 2012</time>
        <nav class="post-tags">
            
            <a href="/tags/sitefinity">#sitefinity</a>
            
        </nav>
        <nav class="post-categories">
            <span>posted in:</span>
            
            <a href="/categories/programming">programming</a>
            
        </nav>
    </div>
    <p>I am testing out Sitefinity right now for an upcoming project. So far, I really like everything I see. It’s a great CMS and should fit out needs just perfectly (for pretty cheap too).</p>

<p>As with all software though, you will inevitably run into things you can’t do so easily (or, at least, as easily as you think you should be able to). I ran into one of those issues yesterday and finally hacked my way to a solution this morning.</p>

<p>##Problem
My problem was this: how do I retrieve the available options for a Choices field in a dynamic module (built with the Module Builder). Honestly, I’m not sure it really matters. That is, I don’t think Sitefinity validates the value of a Choices field against what is technically a “valid” option. I think I read somewhere that it can store any option. However, I wanted to present a drop-down to users that had values that were essentially controlled by the available choices for this field. Here’s the dialog I’m talking about:</p>

<p><img src="/assets/images/2012-10-05-retrieve-dynamic-module-choice-field-value-options-in-sitefinity/choices_dialog.png" alt="Choices field choice options" /></p>

<p>##Solution
Finding a way to retrieve this options through the Sitefinity API (which, in all other respects I’ve investigated so far is really good) was impossible. I started decompiling Sitefinity DLLs to see how it was done and still didn’t really get anywhere. All I could see was the choices being picked up from a config file.</p>

<p>As I read more, I realized this was a bigger clue than I initially thought. The dynamic module information is stored in the App_Data/Sitefinity/Configuration directory in the DynamicModulesConfig.config file. Lo and behold, the options were stored in there–in no less than three places too. Sitefinity has the Config.Get interface for it’s configuration files. However, to get the DynamicModulesConfig.config information, I would have had to call something like Config.Get(). But, the DynamicModulesConfig (in Telerik.Sitefinity.DynamicModules.Configuration) is an internal class. So, I couldn’t do that. I decided upon a “get config file and parse the xml” approach.</p>

<p>Here is my eventual solution. Unless they change the file location or configuration XML structure, it’s pretty safe, albeit a little hacky. I created a simple DynamicModulesHelper class.</p>

<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="k">public</span> <span class="k">static</span> <span class="k">class</span> <span class="nc">DynamicModuleHelper</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">const</span> <span class="kt">string</span> <span class="n">DynamicModulesConfigRelativePath</span> <span class="p">=</span>
    <span class="s">"~/App_Data/Sitefinity/Configuration/DynamicModulesConfig.config"</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">static</span> <span class="n">KeyValuePair</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="kt">string</span><span class="p">&gt;[]</span> <span class="nf">GetChoiceFieldOptions</span><span class="p">(</span>
    <span class="kt">string</span> <span class="n">contentType</span><span class="p">,</span>
    <span class="kt">string</span> <span class="n">dataFieldName</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">XmlNodeList</span> <span class="n">choicesNodes</span> <span class="p">=</span> <span class="nf">GetChoiceNodes</span><span class="p">(</span><span class="n">contentType</span><span class="p">,</span> <span class="n">dataFieldName</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">choicesNodes</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="k">new</span> <span class="n">KeyValuePair</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="kt">string</span><span class="p">&gt;[</span><span class="m">0</span><span class="p">];</span>
        <span class="p">}</span>

        <span class="kt">var</span> <span class="n">choices</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">KeyValuePair</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="kt">string</span><span class="p">&gt;&gt;();</span>
        <span class="k">foreach</span> <span class="p">(</span><span class="n">XmlNode</span> <span class="n">node</span> <span class="k">in</span> <span class="n">choicesNodes</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="nf">ParseChoiceElement</span><span class="p">(</span><span class="n">choices</span><span class="p">,</span> <span class="n">node</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="n">choices</span><span class="p">.</span><span class="nf">ToArray</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">ParseChoiceElement</span><span class="p">(</span>
    <span class="n">List</span><span class="p">&lt;</span><span class="n">KeyValuePair</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="kt">string</span><span class="p">&gt;&gt;</span> <span class="n">choices</span><span class="p">,</span>
    <span class="n">XmlNode</span> <span class="n">node</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">node</span> <span class="p">==</span> <span class="k">null</span> <span class="p">||</span> <span class="n">node</span><span class="p">.</span><span class="n">Attributes</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="kt">string</span> <span class="n">key</span><span class="p">,</span> <span class="k">value</span><span class="p">;</span>
        <span class="n">key</span> <span class="p">=</span> <span class="k">value</span> <span class="p">=</span> <span class="kt">string</span><span class="p">.</span><span class="n">Empty</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">node</span><span class="p">.</span><span class="n">Attributes</span><span class="p">[</span><span class="s">"text"</span><span class="p">]</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">key</span> <span class="p">=</span> <span class="n">node</span><span class="p">.</span><span class="n">Attributes</span><span class="p">[</span><span class="s">"text"</span><span class="p">].</span><span class="n">Value</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">node</span><span class="p">.</span><span class="n">Attributes</span><span class="p">[</span><span class="s">"value"</span><span class="p">]</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">value</span> <span class="p">=</span> <span class="n">node</span><span class="p">.</span><span class="n">Attributes</span><span class="p">[</span><span class="s">"value"</span><span class="p">].</span><span class="n">Value</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(!</span><span class="kt">string</span><span class="p">.</span><span class="nf">IsNullOrEmpty</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="p">&amp;&amp;</span> <span class="p">!</span><span class="kt">string</span><span class="p">.</span><span class="nf">IsNullOrEmpty</span><span class="p">(</span><span class="k">value</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="n">choices</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="k">new</span> <span class="n">KeyValuePair</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="kt">string</span><span class="p">&gt;(</span><span class="n">key</span><span class="p">,</span> <span class="k">value</span><span class="p">));</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">static</span> <span class="n">XmlNodeList</span> <span class="nf">GetChoiceNodes</span><span class="p">(</span>
    <span class="kt">string</span> <span class="n">contentType</span><span class="p">,</span>
    <span class="kt">string</span> <span class="n">dataFieldName</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kt">string</span> <span class="n">dynamicModulesConfigPath</span> <span class="p">=</span> <span class="n">HttpContext</span><span class="p">.</span><span class="n">Current</span><span class="p">.</span><span class="n">Server</span><span class="p">.</span><span class="nf">MapPath</span><span class="p">(</span>
        <span class="n">DynamicModulesConfigRelativePath</span><span class="p">);</span>
        <span class="n">XmlDocument</span> <span class="n">xml</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">ConfigXmlDocument</span><span class="p">();</span>
        <span class="kt">string</span> <span class="n">xpath</span> <span class="p">=</span> <span class="kt">string</span><span class="p">.</span><span class="nf">Concat</span><span class="p">(</span>
        <span class="s">"/dynamicModulesConfig/contentViewControls"</span><span class="p">,</span>
        <span class="kt">string</span><span class="p">.</span><span class="nf">Format</span><span class="p">(</span><span class="s">"/contentViewControl[@contentType='{0}’]"</span><span class="p">,</span> <span class="n">contentType</span><span class="p">),</span>
        <span class="s">"//view[@displayMode=’Read’]"</span><span class="p">,</span>
        <span class="kt">string</span><span class="p">.</span><span class="nf">Format</span><span class="p">(</span><span class="s">"//field[@dataFieldName='{0}’]"</span><span class="p">,</span> <span class="n">dataFieldName</span><span class="p">),</span>
        <span class="s">"/choicesConfig/element"</span>
        <span class="p">);</span>

        <span class="n">xml</span><span class="p">.</span><span class="nf">Load</span><span class="p">(</span><span class="n">dynamicModulesConfigPath</span><span class="p">);</span>
        <span class="n">XmlNodeList</span> <span class="n">choicesNodes</span> <span class="p">=</span> <span class="n">xml</span><span class="p">.</span><span class="nf">SelectNodes</span><span class="p">(</span><span class="n">xpath</span><span class="p">);</span>
        <span class="k">return</span> <span class="n">choicesNodes</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>To get the Choices field options, you call the GetChoiceFieldOptions method, passing in the dynamic module’s content type string (like this one: “Telerik.Sitefinity.DynamicTypes.Model.TestModule.TestModule”) and the name of the Choices field (like this: “RandomChoices”). So, my particular call for just a goofy test module I created was this:</p>

<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="n">KeyValuePair</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="kt">string</span><span class="p">&gt;[]</span> <span class="n">choices</span> <span class="p">=</span> <span class="n">DynamicModuleHelper</span><span class="p">.</span><span class="nf">GetChoiceFieldOptions</span><span class="p">(</span>
    <span class="s">"Telerik.Sitefinity.DynamicTypes.Model.TestModule.TestModule"</span><span class="p">,</span>
    <span class="s">"RandomChoices"</span><span class="p">);</span></code></pre></figure>


</article>

<!-- Disqus comments -->

<section class="comments">
    <h2>Comments</h2>
    <div id="disqus_thread"></div>
<script>
    var disqus_config = function () {
        this.page.url = 'https://www.benramey.com/2012/10/05/retrieve-dynamic-module-choice-field-value-options-in-sitefinity/';
        this.page.identifier = '/2012/10/05/retrieve-dynamic-module-choice-field-value-options-in-sitefinity';
        this.page.title = 'Retrieve Dynamic Module Choice Field Value Options in Sitefinity';
    };

    (function() { // DON'T EDIT BELOW THIS LINE
    var d = document, s = d.createElement('script');
    s.src = 'https://fishybusiness.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
                            
</section>



<section class="related">
    <h2>Related posts</h2>
    <ul class="related-posts">
        
        <li>
            <a href="/2020/05/12/psalm-130/">
                Psalm 130
                <small><time
                        datetime="2020-05-12T00:00:00-05:00">12 May 2020</time></small>
            </a>
        </li>
        
        <li>
            <a href="/2017/01/20/I-Like-Languages-That-Expect-Me-To-Be-a-Great-Programmer/">
                I Like Languages That Expect Me To Be a Great Programmer
                <small><time
                        datetime="2017-01-20T14:05:00-06:00">20 Jan 2017</time></small>
            </a>
        </li>
        
        <li>
            <a href="/2016/08/24/castle-windsor-typedfactoryfacility-and-property-injection/">
                Castle.Windsor TypedFactoryFacility and Unexpected Property Injection Behavior
                <small><time
                        datetime="2016-08-24T07:37:00-05:00">24 Aug 2016</time></small>
            </a>
        </li>
        
    </ul>
    </aside>
    

        </div>
    </main>

    <footer class="footer">
        <div class="container">
            <small>
                &copy; <time datetime="2020-05-14T20:47:05-05:00">2020</time>. All
                rights reserved.
            </small>
        </div>
    </footer>

    <!-- <script>
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

	ga('create', 'UA-1380501-7', 'auto');
	ga('send', 'pageview');
</script> -->
<script>var clicky_site_ids = clicky_site_ids || []; clicky_site_ids.push(101254860);</script>
<script async src="//static.getclicky.com/js"></script>

</body>

</html>
