<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><meta name="next-head-count" content="2"/><link rel="preload" href="/_next/static/css/37b3f20555b3dcfb.css" as="style"/><link rel="stylesheet" href="/_next/static/css/37b3f20555b3dcfb.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-69bfa6990bb9e155.js" defer=""></script><script src="/_next/static/chunks/framework-e70c6273bfe3f237.js" defer=""></script><script src="/_next/static/chunks/main-4011ba79f13e7457.js" defer=""></script><script src="/_next/static/chunks/pages/_app-ce8c41266b210471.js" defer=""></script><script src="/_next/static/chunks/61-425b38ade8d8eadf.js" defer=""></script><script src="/_next/static/chunks/388-1e496dfd41235e8f.js" defer=""></script><script src="/_next/static/chunks/314-535fae6e035750df.js" defer=""></script><script src="/_next/static/chunks/pages/%5B...slug%5D-f75c9ae4d92bd42c.js" defer=""></script><script src="/_next/static/nHa8XjXAWIv4suxIRq4kf/_buildManifest.js" defer=""></script><script src="/_next/static/nHa8XjXAWIv4suxIRq4kf/_ssgManifest.js" defer=""></script><script src="/_next/static/nHa8XjXAWIv4suxIRq4kf/_middlewareManifest.js" defer=""></script></head><body><div id="__next" data-reactroot=""><div><header><div class="container"><div class="d-flex justify-content-between align-item-center"><a class="d-flex justify-content-start align-items-center mr-2" href="/"><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%2740%27%20height=%2740%27/%3e"/></span><img alt="Gravatar" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="Gravatar" src="https://en.gravatar.com/userimage/738990/32d8e61848233a67f5e02dcc43be0ff8.jpeg" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" loading="lazy"/></noscript></span><span class="ml-2">Ben Ramey&#x27;s Blog</span></a><div class="d-none d-sm-flex flex-column justify-content-around ml-2"><small>Scripture, programming problems, solutions and stories.</small></div></div></div></header><nav class="main"><div class="container d-flex justify-content-center"><a href="/archive/">archive</a><a href="/tags/">tags</a><a href="/categories/">categories</a></div></nav><main><div class="container"><article class="post"><h1 class="post-title">ANSI/UTF-8 Encoding Problem</h1><div class="post-info d-flex justify-content-start"><time dateTime="2011-11-14T06:00:00Z" class="post-date">Mon Nov 14th, 2011<!-- -->, <!-- -->almost 12 years<!-- --> ago</time><nav class="post-tags"></nav><nav class="post-categories"><span>posted in:</span><a href="/categories/programming/">programming</a></nav></div><div><h2>Problem</h2>
<p>I ran into a problem in a project I was working on recently. The basics of the project were to take data out of a MySQL database and transform that data into an XML file schema for a
<a href="http://day.com/day/en/products.html">Day CQ5 CMS</a>
<a href="http://www.ibm.com/developerworks/java/library/j-jcr/">Java Content Repository (JCR)</a>.</p>
<p>I kept running into an issue with certain text fields of user-entered data where I would get all these funky, special characters in the text. I knew it had to be some kind of encoding issue where I wasn’t outputting or getting the data with the right character encoding.</p>
<p>I don’t know much about character encoding, except that there is a difference between them!</p>
<h2>Solution</h2>
<p>After some digging around and playing with Notepad++ (where I could switch the encoding of the text), I found at least a glimmer of hope. When I had the character encoding set to ANSI in Notepad++, pasted in the troublesome text, and then switched the encoding to UTF-8, all of my problems disappeared.</p>
<p>So, eventually, I came up with these few lines of code which convert the encoding of my text and fixed all of my problems. Woohoo!</p>
<div class="remark-highlight"><pre class="language-csharp"><code class="language-csharp"><span class="token class-name">Encoding</span> targetEncoding <span class="token operator">=</span> Encoding<span class="token punctuation">.</span><span class="token function">GetEncoding</span><span class="token punctuation">(</span><span class="token number">1252</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> utf8Bytes <span class="token operator">=</span> targetEncoding<span class="token punctuation">.</span><span class="token function">GetBytes</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> ansiBytes <span class="token operator">=</span> Encoding<span class="token punctuation">.</span><span class="token function">Convert</span><span class="token punctuation">(</span>Encoding<span class="token punctuation">.</span>UTF8<span class="token punctuation">,</span>
targetEncoding<span class="token punctuation">,</span>
utf8Bytes<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">return</span> targetEncoding<span class="token punctuation">.</span><span class="token function">GetString</span><span class="token punctuation">(</span>ansiBytes<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
<p>What this simple code does is first get the Encoding for the ANSI character encoding (1252 is ANSI, apparently). It then gets the bytes of the string with the ANSI encoding, converts them from the ANSI encoding to UTF-8 encoding and then gets the string with the ANSI encoding.</p>
<p>So, quite honestly, I’m not 100% sure why this works. The Notepad++ experiment would seem to indicate the opposite: that I had to convert from ANSI to UTF-8. But, that only compounded the problem when I wrote it that way in code. When I reversed the conversion, it worked as I was hoping.</p>
</div></article><section class="comments"><a id="comments-section"><h2>Comments</h2></a><div id="disqus_thread"></div></section></div></main><footer class="footer"><div class="container"><hr/><small>© <time dateTime="2023-08-21T00:02:20.640Z">2023</time>. All rights reserved.</small></div><script async="" defer="" data-website-id="b5832ded-a501-4aab-b4ce-ef0373a1a887" src="https://umami.benramey.com/umami.js"></script></footer></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"tags":[],"categories":["programming"],"title":"ANSI/UTF-8 Encoding Problem","contentHtml":"\u003ch2\u003eProblem\u003c/h2\u003e\n\u003cp\u003eI ran into a problem in a project I was working on recently. The basics of the project were to take data out of a MySQL database and transform that data into an XML file schema for a\n\u003ca href=\"http://day.com/day/en/products.html\"\u003eDay CQ5 CMS\u003c/a\u003e\n\u003ca href=\"http://www.ibm.com/developerworks/java/library/j-jcr/\"\u003eJava Content Repository (JCR)\u003c/a\u003e.\u003c/p\u003e\n\u003cp\u003eI kept running into an issue with certain text fields of user-entered data where I would get all these funky, special characters in the text. I knew it had to be some kind of encoding issue where I wasn’t outputting or getting the data with the right character encoding.\u003c/p\u003e\n\u003cp\u003eI don’t know much about character encoding, except that there is a difference between them!\u003c/p\u003e\n\u003ch2\u003eSolution\u003c/h2\u003e\n\u003cp\u003eAfter some digging around and playing with Notepad++ (where I could switch the encoding of the text), I found at least a glimmer of hope. When I had the character encoding set to ANSI in Notepad++, pasted in the troublesome text, and then switched the encoding to UTF-8, all of my problems disappeared.\u003c/p\u003e\n\u003cp\u003eSo, eventually, I came up with these few lines of code which convert the encoding of my text and fixed all of my problems. Woohoo!\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-csharp\"\u003e\u003ccode class=\"language-csharp\"\u003e\u003cspan class=\"token class-name\"\u003eEncoding\u003c/span\u003e targetEncoding \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e Encoding\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eGetEncoding\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token number\"\u003e1252\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token class-name\"\u003e\u003cspan class=\"token keyword\"\u003ebyte\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003c/span\u003e utf8Bytes \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e targetEncoding\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eGetBytes\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003etext\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token class-name\"\u003e\u003cspan class=\"token keyword\"\u003ebyte\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003c/span\u003e ansiBytes \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e Encoding\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eConvert\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eEncoding\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eUTF8\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\ntargetEncoding\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\nutf8Bytes\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e targetEncoding\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eGetString\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eansiBytes\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eWhat this simple code does is first get the Encoding for the ANSI character encoding (1252 is ANSI, apparently). It then gets the bytes of the string with the ANSI encoding, converts them from the ANSI encoding to UTF-8 encoding and then gets the string with the ANSI encoding.\u003c/p\u003e\n\u003cp\u003eSo, quite honestly, I’m not 100% sure why this works. The Notepad++ experiment would seem to indicate the opposite: that I had to convert from ANSI to UTF-8. But, that only compounded the problem when I wrote it that way in code. When I reversed the conversion, it worked as I was hoping.\u003c/p\u003e\n","date":"2011-11-14T06:00:00Z","slug":"/2011/11/14/ansiutf-8-encoding-problem"},"__N_SSG":true},"page":"/[...slug]","query":{"slug":["2011","11","14","ansiutf-8-encoding-problem"]},"buildId":"nHa8XjXAWIv4suxIRq4kf","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>