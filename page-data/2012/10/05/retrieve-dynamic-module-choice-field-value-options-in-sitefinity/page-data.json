{"componentChunkName":"component---src-templates-post-js","path":"/2012/10/05/retrieve-dynamic-module-choice-field-value-options-in-sitefinity/","result":{"data":{"markdownRemark":{"html":"<p>I am testing out Sitefinity right now for an upcoming project. So far, I really like everything I see. It’s a great CMS and should fit out needs just perfectly (for pretty cheap too).</p>\n<p>As with all software though, you will inevitably run into things you can’t do so easily (or, at least, as easily as you think you should be able to). I ran into one of those issues yesterday and finally hacked my way to a solution this morning.</p>\n<h2>Problem</h2>\n<p>My problem was this: how do I retrieve the available options for a Choices field in a dynamic module (built with the Module Builder). Honestly, I’m not sure it really matters. That is, I don’t think Sitefinity validates the value of a Choices field against what is technically a “valid” option. I think I read somewhere that it can store any option. However, I wanted to present a drop-down to users that had values that were essentially controlled by the available choices for this field. Here’s the dialog I’m talking about:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 436px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/c0e46084449620662ff7fd3cfb8e6fbd/8574c/choices_dialog.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 96%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAYAAACQjC21AAAACXBIWXMAAA7DAAAOwwHHb6hkAAACYElEQVQ4y51Ua3OiQBDk//+qqzo/XXlHgkBURM0prwVFRB4C1tz0oDGJxkqdVV1LyNLT0z27mq7r1HUdlWVJVVUJjsejAO8OhwOjOK93UBS03+fUNA2Nx2PSRqZFBb+0bZvm8zmtViuazWYMl5Ik4c17yrLsIbbbrXA4jkOa8WyIKss0e9LFgszzcxRF8kGaprTb7b4ECOu6pul0Sppt2fzBjn4OBjRg6PofqYZ2QPaI6AIU7AkdtGxSeZaLVtFynuffIrpVyITP3DL+mEymQuiwbJgbRUoqY/NjpB8VmqORpPn715BMwyKLYZsvVPC75thQfU78K5Ts/2azuXo4YkJEXjFB27Z06k68dvTdH0YuST4QmlypkX/8zw/FMV7XlHk8IB3DW1f12xAj6UfAPqwI5doyezgeT6hggic+MSaPEIy+JPcICAJjhcHHM2bZcWZ9y/AuUTG9Lv+S74WkOGHY0Dat+PsZaBOqMGrL5VIE1EwoCg3DoNPpJKHEcUJhEFHgh7wpE9J7yTZcCEGAcMEnSwjrqvcQMweFaNtb+xR4AalQ8Rrypp6gfo/6KCovhG8KbwjZ4JBJfCb11wHPZiXJo21Be0XHo4Vk8a3rureEqFjkFe3S/ubYcHWYjSO4Z2S4ovDM73rk4qHv+3KByNG7eAjCsuKTMvnBN82MPM+X6t7aoxCbPY8yl33i0NLzRXC5fd5fX0gZx1eDD1BouUOWD09eScWxeOOxgj2TFyuPDnxmc/YZqj8DqmEF7lBtOBxKtURtOeVY1Mm6waooUooUt4ciCs93EIZ927r+RP8AS4mcHLtpRacAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Choices field choice options\"\n        title=\"Choices field choice options\"\n        src=\"/static/c0e46084449620662ff7fd3cfb8e6fbd/8574c/choices_dialog.png\"\n        srcset=\"/static/c0e46084449620662ff7fd3cfb8e6fbd/772e8/choices_dialog.png 200w,\n/static/c0e46084449620662ff7fd3cfb8e6fbd/e17e5/choices_dialog.png 400w,\n/static/c0e46084449620662ff7fd3cfb8e6fbd/8574c/choices_dialog.png 436w\"\n        sizes=\"(max-width: 436px) 100vw, 436px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<h2>Solution</h2>\n<p>Finding a way to retrieve this options through the Sitefinity API (which, in all other respects I’ve investigated so far is really good) was impossible. I started decompiling Sitefinity DLLs to see how it was done and still didn’t really get anywhere. All I could see was the choices being picked up from a config file.</p>\n<p>As I read more, I realized this was a bigger clue than I initially thought. The dynamic module information is stored in the App_Data/Sitefinity/Configuration directory in the DynamicModulesConfig.config file. Lo and behold, the options were stored in there–in no less than three places too. Sitefinity has the Config.Get interface for it’s configuration files. However, to get the DynamicModulesConfig.config information, I would have had to call something like Config.Get(). But, the DynamicModulesConfig (in Telerik.Sitefinity.DynamicModules.Configuration) is an internal class. So, I couldn’t do that. I decided upon a “get config file and parse the xml” approach.</p>\n<p>Here is my eventual solution. Unless they change the file location or configuration XML structure, it’s pretty safe, albeit a little hacky. I created a simple DynamicModulesHelper class.</p>\n<div class=\"gatsby-highlight\" data-language=\"csharp\"><pre class=\"highlight-csharp\"><code class=\"highlight-csharp\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">DynamicModuleHelper</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">const</span> <span class=\"token class-name\"><span class=\"token keyword\">string</span></span> DynamicModulesConfigRelativePath <span class=\"token operator\">=</span>\n    <span class=\"token string\">\"~/App_Data/Sitefinity/Configuration/DynamicModulesConfig.config\"</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token return-type class-name\">KeyValuePair<span class=\"token punctuation\">&lt;</span><span class=\"token keyword\">string</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">string</span><span class=\"token punctuation\">></span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span></span> <span class=\"token function\">GetChoiceFieldOptions</span><span class=\"token punctuation\">(</span>\n    <span class=\"token class-name\"><span class=\"token keyword\">string</span></span> contentType<span class=\"token punctuation\">,</span>\n    <span class=\"token class-name\"><span class=\"token keyword\">string</span></span> dataFieldName<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">XmlNodeList</span> choicesNodes <span class=\"token operator\">=</span> <span class=\"token function\">GetChoiceNodes</span><span class=\"token punctuation\">(</span>contentType<span class=\"token punctuation\">,</span> dataFieldName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>choicesNodes <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">KeyValuePair<span class=\"token punctuation\">&lt;</span><span class=\"token keyword\">string</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">string</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token class-name\"><span class=\"token keyword\">var</span></span> choices <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">List<span class=\"token punctuation\">&lt;</span>KeyValuePair<span class=\"token punctuation\">&lt;</span><span class=\"token keyword\">string</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">string</span><span class=\"token punctuation\">></span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">foreach</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">XmlNode</span> node <span class=\"token keyword\">in</span> choicesNodes<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">{</span>\n            <span class=\"token function\">ParseChoiceElement</span><span class=\"token punctuation\">(</span>choices<span class=\"token punctuation\">,</span> node<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token keyword\">return</span> choices<span class=\"token punctuation\">.</span><span class=\"token function\">ToArray</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token return-type class-name\"><span class=\"token keyword\">void</span></span> <span class=\"token function\">ParseChoiceElement</span><span class=\"token punctuation\">(</span>\n    <span class=\"token class-name\">List<span class=\"token punctuation\">&lt;</span>KeyValuePair<span class=\"token punctuation\">&lt;</span><span class=\"token keyword\">string</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">string</span><span class=\"token punctuation\">></span><span class=\"token punctuation\">></span></span> choices<span class=\"token punctuation\">,</span>\n    <span class=\"token class-name\">XmlNode</span> node<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>node <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span> <span class=\"token operator\">||</span> node<span class=\"token punctuation\">.</span>Attributes <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token class-name\"><span class=\"token keyword\">string</span></span> key<span class=\"token punctuation\">,</span> <span class=\"token keyword\">value</span><span class=\"token punctuation\">;</span>\n        key <span class=\"token operator\">=</span> <span class=\"token keyword\">value</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">string</span><span class=\"token punctuation\">.</span>Empty<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>node<span class=\"token punctuation\">.</span>Attributes<span class=\"token punctuation\">[</span><span class=\"token string\">\"text\"</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">{</span>\n            key <span class=\"token operator\">=</span> node<span class=\"token punctuation\">.</span>Attributes<span class=\"token punctuation\">[</span><span class=\"token string\">\"text\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>Value<span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>node<span class=\"token punctuation\">.</span>Attributes<span class=\"token punctuation\">[</span><span class=\"token string\">\"value\"</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">value</span> <span class=\"token operator\">=</span> node<span class=\"token punctuation\">.</span>Attributes<span class=\"token punctuation\">[</span><span class=\"token string\">\"value\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>Value<span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token keyword\">string</span><span class=\"token punctuation\">.</span><span class=\"token function\">IsNullOrEmpty</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token operator\">!</span><span class=\"token keyword\">string</span><span class=\"token punctuation\">.</span><span class=\"token function\">IsNullOrEmpty</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">value</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">{</span>\n            choices<span class=\"token punctuation\">.</span><span class=\"token function\">Add</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">KeyValuePair<span class=\"token punctuation\">&lt;</span><span class=\"token keyword\">string</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">string</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">,</span> <span class=\"token keyword\">value</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token return-type class-name\">XmlNodeList</span> <span class=\"token function\">GetChoiceNodes</span><span class=\"token punctuation\">(</span>\n    <span class=\"token class-name\"><span class=\"token keyword\">string</span></span> contentType<span class=\"token punctuation\">,</span>\n    <span class=\"token class-name\"><span class=\"token keyword\">string</span></span> dataFieldName<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\"><span class=\"token keyword\">string</span></span> dynamicModulesConfigPath <span class=\"token operator\">=</span> HttpContext<span class=\"token punctuation\">.</span>Current<span class=\"token punctuation\">.</span>Server<span class=\"token punctuation\">.</span><span class=\"token function\">MapPath</span><span class=\"token punctuation\">(</span>\n        DynamicModulesConfigRelativePath<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\">XmlDocument</span> xml <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">ConfigXmlDocument</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\"><span class=\"token keyword\">string</span></span> xpath <span class=\"token operator\">=</span> <span class=\"token keyword\">string</span><span class=\"token punctuation\">.</span><span class=\"token function\">Concat</span><span class=\"token punctuation\">(</span>\n        <span class=\"token string\">\"/dynamicModulesConfig/contentViewControls\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token keyword\">string</span><span class=\"token punctuation\">.</span><span class=\"token function\">Format</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/contentViewControl[@contentType='{0}’]\"</span><span class=\"token punctuation\">,</span> contentType<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">\"//view[@displayMode=’Read’]\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token keyword\">string</span><span class=\"token punctuation\">.</span><span class=\"token function\">Format</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"//field[@dataFieldName='{0}’]\"</span><span class=\"token punctuation\">,</span> dataFieldName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">\"/choicesConfig/element\"</span>\n        <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        xml<span class=\"token punctuation\">.</span><span class=\"token function\">Load</span><span class=\"token punctuation\">(</span>dynamicModulesConfigPath<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\">XmlNodeList</span> choicesNodes <span class=\"token operator\">=</span> xml<span class=\"token punctuation\">.</span><span class=\"token function\">SelectNodes</span><span class=\"token punctuation\">(</span>xpath<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> choicesNodes<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>To get the Choices field options, you call the GetChoiceFieldOptions method, passing in the dynamic module’s content type string (like this one: “Telerik.Sitefinity.DynamicTypes.Model.TestModule.TestModule”) and the name of the Choices field (like this: “RandomChoices”). So, my particular call for just a goofy test module I created was this:</p>\n<div class=\"gatsby-highlight\" data-language=\"csharp\"><pre class=\"highlight-csharp\"><code class=\"highlight-csharp\"><span class=\"token class-name\">KeyValuePair<span class=\"token punctuation\">&lt;</span><span class=\"token keyword\">string</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">string</span><span class=\"token punctuation\">></span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span></span> choices <span class=\"token operator\">=</span> DynamicModuleHelper<span class=\"token punctuation\">.</span><span class=\"token function\">GetChoiceFieldOptions</span><span class=\"token punctuation\">(</span>\n    <span class=\"token string\">\"Telerik.Sitefinity.DynamicTypes.Model.TestModule.TestModule\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"RandomChoices\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>","fields":{"slug":"/2012/10/05/retrieve-dynamic-module-choice-field-value-options-in-sitefinity/"},"frontmatter":{"title":"Retrieve Dynamic Module Choice Field Value Options in Sitefinity","formattedDate":"Fri Oct 5th 2012","isoDate":"2012-10-05T00:00:00.000Z","fromNowDate":"9 years ago","categories":["programming"],"tags":["sitefinity"]}},"site":{"siteMetadata":{"title":"Ben Ramey's Blog","tagline":"Scripture, programming problems, solutions and stories."}},"sitePage":{"path":"/dev-404-page/"}},"pageContext":{"slug":"/2012/10/05/retrieve-dynamic-module-choice-field-value-options-in-sitefinity/"}},"staticQueryHashes":[]}