<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><meta name="next-head-count" content="2"/><link rel="preload" href="/_next/static/css/37b3f20555b3dcfb.css" as="style"/><link rel="stylesheet" href="/_next/static/css/37b3f20555b3dcfb.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-69bfa6990bb9e155.js" defer=""></script><script src="/_next/static/chunks/framework-e70c6273bfe3f237.js" defer=""></script><script src="/_next/static/chunks/main-4011ba79f13e7457.js" defer=""></script><script src="/_next/static/chunks/pages/_app-ce8c41266b210471.js" defer=""></script><script src="/_next/static/chunks/61-425b38ade8d8eadf.js" defer=""></script><script src="/_next/static/chunks/388-1e496dfd41235e8f.js" defer=""></script><script src="/_next/static/chunks/314-535fae6e035750df.js" defer=""></script><script src="/_next/static/chunks/pages/%5B...slug%5D-f75c9ae4d92bd42c.js" defer=""></script><script src="/_next/static/_VAN1WmBcwLBkr__PhrJU/_buildManifest.js" defer=""></script><script src="/_next/static/_VAN1WmBcwLBkr__PhrJU/_ssgManifest.js" defer=""></script><script src="/_next/static/_VAN1WmBcwLBkr__PhrJU/_middlewareManifest.js" defer=""></script></head><body><div id="__next" data-reactroot=""><div><header><div class="container"><div class="d-flex justify-content-between align-item-center"><a class="d-flex justify-content-start align-items-center mr-2" href="/"><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%2740%27%20height=%2740%27/%3e"/></span><img alt="Gravatar" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="Gravatar" src="https://en.gravatar.com/userimage/738990/32d8e61848233a67f5e02dcc43be0ff8.jpeg" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" loading="lazy"/></noscript></span><span class="ml-2">Ben Ramey&#x27;s Blog</span></a><div class="d-none d-sm-flex flex-column justify-content-around ml-2"><small>Scripture, programming problems, solutions and stories.</small></div></div></div></header><nav class="main"><div class="container d-flex justify-content-center"><a href="/archive/">archive</a><a href="/tags/">tags</a><a href="/categories/">categories</a></div></nav><main><div class="container"><article class="post"><h1 class="post-title">EPiServer 7: Cannot decrypt password</h1><div class="post-info d-flex justify-content-start"><time dateTime="2014-04-17T06:00:00Z" class="post-date">Thu Apr 17th, 2014<!-- -->, <!-- -->over 8 years<!-- --> ago</time><nav class="post-tags"><a href="/tags/episerver/">#<!-- -->episerver</a></nav><nav class="post-categories"><span>posted in:</span><a href="/categories/programming/">programming</a></nav></div><div><h2>Problem</h2>
<p>I’ve been dealing with an issue in EPiServer 7 recently. I got this error when trying to log into the admin back-end of the site.</p>
<div class="remark-highlight"><pre class="language-text"><code class="language-text">Cannot decrypt password

Description: An unhandled exception occurred during the execution of the current web request. Please review the stack trace for more information about the error and where it originated in the code.

Exception Details: System.InvalidOperationException: Cannot decrypt password

Source Error:

An unhandled exception was generated during the execution of the current web request. Information regarding the origin and location of the exception can be identified using the exception stack trace below.

Stack Trace:

[InvalidOperationException: Cannot decrypt password]
EPiServer.Common.Security.HMACPasswordProvider.DecryptPassword(Byte[] ciphertext) +60
EPiServer.Common.Web.Authorization.Integrator.SynchronizeUser(MembershipUser membershipUser, String password, Boolean enableCreateNew) +1116
System.Web.SyncEventExecutionStep.System.Web.HttpApplication.IExecutionStep.Execute() +80
System.Web.HttpApplication.ExecuteStep(IExecutionStep step, Boolean&#x26;amp; completedSynchronously) +165</code></pre></div>
<h2>Scenario</h2>
<p>We originally installed the Relate+ site for our EPiServer installation. Through various bad decisions, we didn’t keep the custom code and templates we wrote separate from the Relate+ stuff. So, we inevitably created a mess where we did not need a ton of the Relate+ templates, page types, block types, etc but we could not longer easily pull our custom stuff out from the tangled mess.</p>
<p>Well, we undertook the disentangling anyway (a good decision) and ended up with a much cleaner code base. This meant re-installing EPiServer for a clean (without Relate+) beginning. The database would remain the same to keep our content.</p>
<p>We ran into this error when we got the new, cleaned-up site installed and running and then tried to log into the administration portion of the site.</p>
<h2>Solution</h2>
<p>At first, I found this post online: http://world.episerver.com/Modules/Forum/Pages/Thread.aspx?id=77776 which suggested changing over to the multiplexing membership and role providers and described the new hashing mechanism in EPiServer 7.</p>
<p>At first, this seemed to work. Yay! But, the joy didn’t last long. I soon got the error again even after using the multiplexing providers. I dug a little deeper into the issue.</p>
<p>What I found was (in retrospect) pretty obvious. When we did the new, clean installation of EPiServer, it also created a new web.config with new attributes on the machineKey element. These properties are used with forms authentication to encrypt and decrypt information. Well, we didn’t make sure to keep the same values between the old install and the new install. So, when it tried to decrypt login information created with the old descryptionKey using the new decryptionKey, it obviously didn’t work.</p>
<p>Luckily, our trusty Systems Admins always keep backups of stuff they replace. We just went into the old web.config file from the previous site, copied the entire <machineKey> element and overwrite it in the new web.config. After an app pool recycle, the login was working great.</p>
</div></article><section class="comments"><a id="comments-section"><h2>Comments</h2></a><div id="disqus_thread"></div></section></div></main><footer class="footer"><div class="container"><hr/><small>© <time dateTime="2022-09-22T00:01:28.606Z">2022</time>. All rights reserved.</small></div><script async="" defer="" data-website-id="b5832ded-a501-4aab-b4ce-ef0373a1a887" src="https://umami.benramey.com/umami.js"></script></footer></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"tags":["episerver"],"categories":["programming"],"title":"EPiServer 7: Cannot decrypt password","contentHtml":"\u003ch2\u003eProblem\u003c/h2\u003e\n\u003cp\u003eI’ve been dealing with an issue in EPiServer 7 recently. I got this error when trying to log into the admin back-end of the site.\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-text\"\u003e\u003ccode class=\"language-text\"\u003eCannot decrypt password\n\nDescription: An unhandled exception occurred during the execution of the current web request. Please review the stack trace for more information about the error and where it originated in the code.\n\nException Details: System.InvalidOperationException: Cannot decrypt password\n\nSource Error:\n\nAn unhandled exception was generated during the execution of the current web request. Information regarding the origin and location of the exception can be identified using the exception stack trace below.\n\nStack Trace:\n\n[InvalidOperationException: Cannot decrypt password]\nEPiServer.Common.Security.HMACPasswordProvider.DecryptPassword(Byte[] ciphertext) +60\nEPiServer.Common.Web.Authorization.Integrator.SynchronizeUser(MembershipUser membershipUser, String password, Boolean enableCreateNew) +1116\nSystem.Web.SyncEventExecutionStep.System.Web.HttpApplication.IExecutionStep.Execute() +80\nSystem.Web.HttpApplication.ExecuteStep(IExecutionStep step, Boolean\u0026#x26;amp; completedSynchronously) +165\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch2\u003eScenario\u003c/h2\u003e\n\u003cp\u003eWe originally installed the Relate+ site for our EPiServer installation. Through various bad decisions, we didn’t keep the custom code and templates we wrote separate from the Relate+ stuff. So, we inevitably created a mess where we did not need a ton of the Relate+ templates, page types, block types, etc but we could not longer easily pull our custom stuff out from the tangled mess.\u003c/p\u003e\n\u003cp\u003eWell, we undertook the disentangling anyway (a good decision) and ended up with a much cleaner code base. This meant re-installing EPiServer for a clean (without Relate+) beginning. The database would remain the same to keep our content.\u003c/p\u003e\n\u003cp\u003eWe ran into this error when we got the new, cleaned-up site installed and running and then tried to log into the administration portion of the site.\u003c/p\u003e\n\u003ch2\u003eSolution\u003c/h2\u003e\n\u003cp\u003eAt first, I found this post online: http://world.episerver.com/Modules/Forum/Pages/Thread.aspx?id=77776 which suggested changing over to the multiplexing membership and role providers and described the new hashing mechanism in EPiServer 7.\u003c/p\u003e\n\u003cp\u003eAt first, this seemed to work. Yay! But, the joy didn’t last long. I soon got the error again even after using the multiplexing providers. I dug a little deeper into the issue.\u003c/p\u003e\n\u003cp\u003eWhat I found was (in retrospect) pretty obvious. When we did the new, clean installation of EPiServer, it also created a new web.config with new attributes on the machineKey element. These properties are used with forms authentication to encrypt and decrypt information. Well, we didn’t make sure to keep the same values between the old install and the new install. So, when it tried to decrypt login information created with the old descryptionKey using the new decryptionKey, it obviously didn’t work.\u003c/p\u003e\n\u003cp\u003eLuckily, our trusty Systems Admins always keep backups of stuff they replace. We just went into the old web.config file from the previous site, copied the entire \u003cmachineKey\u003e element and overwrite it in the new web.config. After an app pool recycle, the login was working great.\u003c/p\u003e\n","date":"2014-04-17T06:00:00Z","slug":"/2014/04/17/episerver-7-cannot-decrypt-password"},"__N_SSG":true},"page":"/[...slug]","query":{"slug":["2014","04","17","episerver-7-cannot-decrypt-password"]},"buildId":"_VAN1WmBcwLBkr__PhrJU","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>