<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><meta name="next-head-count" content="2"/><link rel="preload" href="/_next/static/css/37b3f20555b3dcfb.css" as="style"/><link rel="stylesheet" href="/_next/static/css/37b3f20555b3dcfb.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-69bfa6990bb9e155.js" defer=""></script><script src="/_next/static/chunks/framework-e70c6273bfe3f237.js" defer=""></script><script src="/_next/static/chunks/main-4011ba79f13e7457.js" defer=""></script><script src="/_next/static/chunks/pages/_app-ce8c41266b210471.js" defer=""></script><script src="/_next/static/chunks/61-425b38ade8d8eadf.js" defer=""></script><script src="/_next/static/chunks/388-1e496dfd41235e8f.js" defer=""></script><script src="/_next/static/chunks/314-535fae6e035750df.js" defer=""></script><script src="/_next/static/chunks/pages/%5B...slug%5D-f75c9ae4d92bd42c.js" defer=""></script><script src="/_next/static/q_Z7kKqJqS6BT5l45WQTS/_buildManifest.js" defer=""></script><script src="/_next/static/q_Z7kKqJqS6BT5l45WQTS/_ssgManifest.js" defer=""></script><script src="/_next/static/q_Z7kKqJqS6BT5l45WQTS/_middlewareManifest.js" defer=""></script></head><body><div id="__next" data-reactroot=""><div><header><div class="container"><div class="d-flex justify-content-between align-item-center"><a class="d-flex justify-content-start align-items-center mr-2" href="/"><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%2740%27%20height=%2740%27/%3e"/></span><img alt="Gravatar" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="Gravatar" src="https://en.gravatar.com/userimage/738990/32d8e61848233a67f5e02dcc43be0ff8.jpeg" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" loading="lazy"/></noscript></span><span class="ml-2">Ben Ramey&#x27;s Blog</span></a><div class="d-none d-sm-flex flex-column justify-content-around ml-2"><small>Scripture, programming problems, solutions and stories.</small></div></div></div></header><nav class="main"><div class="container d-flex justify-content-center"><a href="/archive/">archive</a><a href="/tags/">tags</a><a href="/categories/">categories</a></div></nav><main><div class="container"><article class="post"><h1 class="post-title">Iterating All EPiServer Catalog MetaObjects</h1><div class="post-info d-flex justify-content-start"><time dateTime="2020-05-27T06:00:00Z" class="post-date">Wed May 27th, 2020<!-- -->, <!-- -->over 2 years<!-- --> ago</time><nav class="post-tags"><a href="/tags/episerver/">#<!-- -->episerver</a><a href="/tags/csharp/">#<!-- -->csharp</a><a href="/tags/dotnet/">#<!-- -->dotnet</a></nav><nav class="post-categories"><span>posted in:</span><a href="/categories/programming/">programming</a></nav></div><div><p>If you're maintaining an e-commerce-enabled site in EPiServer and you're using the built-in catalog, then
you have probably found the need to incorporate external data into the catalog, perhaps from various sources.</p>
<p>Such is the case for me on an EPiServer site I've been working on over the last (almost) four years. The primary
data for the catalog comes into EPiServer from an external PIM system. But, then there is all sorts of ancillary
data that needs to calculated from existing fields or pulled from external sources. These external data sources
don't really provide a way to incrementally apply deltas for the data they provide. The only option to make updates is to walk
through the entire catalog and see if anything needs updating when matched against the external data I've pulled.</p>
<p>This external data is stored in the catalog as custom EPiServer MetaFields. So,
a need arose to easily walk through the entire catalog, pick up every MetaObject (to update the custom MetaFields)
in every available catalog culture and make the appropriate updates.</p>
<p>Below are the iterators I wrote to accomplish this. They let you walk the entire catalog tree (in a breadth-first manner)
starting from the top as if you were iterating a simple C# array or list.</p>
<h2>High-Level Usage</h2>
<p>Because all we're doing is writing iterators, the high-level usage looks just like you were interating through
an <code>IEnumerable</code> in C# like an array or a <code>List&#x3C;T></code>.</p>
<p>The iterators are implemented as extension methods on the <code>ICatalogSystem</code> interface. So, iterating through all
of the catalog entry MetaObjects looks like this.</p>
<div class="remark-highlight"><pre class="language-csharp"><code class="language-csharp"><span class="token keyword">using</span> <span class="token namespace">Mediachase<span class="token punctuation">.</span>Commerce<span class="token punctuation">.</span>Catalog</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">Mediachase<span class="token punctuation">.</span>MetaDataPlus</span><span class="token punctuation">;</span>

<span class="token class-name">ICatalogSystem</span> catalog <span class="token operator">=</span> CatalogContext<span class="token punctuation">.</span>Current<span class="token punctuation">;</span>
<span class="token class-name">MetaDataContext</span> mdc <span class="token operator">=</span> MetaDataContext<span class="token punctuation">.</span>Instance<span class="token punctuation">;</span>

<span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">MetaObject</span> metaObject<span class="token punctuation">,</span> <span class="token class-name">MetaDataContext</span> metaDataContext<span class="token punctuation">)</span> entryMO <span class="token keyword">in</span> catalog<span class="token punctuation">.</span><span class="token function">AllCatalogSystemEntryMetaObjects</span><span class="token punctuation">(</span>mdc<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    entryMO<span class="token punctuation">.</span>metaObject<span class="token punctuation">[</span><span class="token string">"SomeCustomMetaFieldName"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"external data source value here"</span><span class="token punctuation">;</span>
    entryMO<span class="token punctuation">.</span>metaObject<span class="token punctuation">.</span><span class="token function">AcceptChanges</span><span class="token punctuation">(</span>entryMO<span class="token punctuation">.</span>metaDataContext<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div>
<p>I implemented the separate iterators for NodeContent MetaObjects and the EntryContent
MetaObjects. You easily use them in combination to iterate through the MetaObjects of the entire catalog tree.</p>
<p>Note a couple of things from the example code above:</p>
<ol>
<li>You have to give the iterator the MetaDataContext. As we'll see in the iterator code, it will copy this MDC for each catalog language so that you get a MetaObject for every culture present in your catalog.</li>
<li>Because of #1 above, the current MetaDataContext is passed to you during iteration so that you know which catalog culture this MetaObject is for.</li>
</ol>
<h2>Extension Method Code</h2>
<p>The extension method code for AllCatalogSystemEntryMetaObjects is pretty simple. It uses four iterators in nested foreach loops to loop through</p>
<ol>
<li>All catalogs</li>
<li>All nodes</li>
<li>All entries</li>
<li>All meta objects</li>
</ol>
<div class="remark-highlight"><pre class="language-csharp"><code class="language-csharp"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name">IEnumerable<span class="token punctuation">&#x3C;</span><span class="token punctuation">(</span>MetaObject metaObject<span class="token punctuation">,</span> MetaDataContext metaDataContext<span class="token punctuation">)</span><span class="token punctuation">></span></span> <span class="token function">AllCatalogSystemEntryMetaObjects</span><span class="token punctuation">(</span>
    <span class="token keyword">this</span> <span class="token class-name">ICatalogSystem</span> catalogSystem<span class="token punctuation">,</span>
    <span class="token class-name">MetaDataContext</span> metaDataContext<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">var</span></span> catalog <span class="token keyword">in</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">CatalogSystemCatalogs</span><span class="token punctuation">(</span>catalogSystem<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">var</span></span> node <span class="token keyword">in</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">CatalogSystemNodes</span><span class="token punctuation">(</span>catalogSystem<span class="token punctuation">,</span> catalog<span class="token punctuation">.</span>CatalogId<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">var</span></span> entry <span class="token keyword">in</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">CatalogSystemEntries</span><span class="token punctuation">(</span>catalogSystem<span class="token punctuation">,</span> catalog<span class="token punctuation">.</span>CatalogId<span class="token punctuation">,</span> node<span class="token punctuation">.</span>CatalogNodeId<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">var</span></span> tuple <span class="token keyword">in</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">CatalogSystemEntryMetaObjects</span><span class="token punctuation">(</span>metaDataContext<span class="token punctuation">,</span> catalog<span class="token punctuation">,</span> entry<span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">{</span>
                    <span class="token keyword">yield</span> <span class="token keyword">return</span> tuple<span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div>
<p>I broke the iteration down into separate iterators in this fashion so that I could easily iterate through all the entries (for example) in a single node, if I knew from the beginning which node I wanted to start at. If that was the case, I could easily write another extension method that took a node ID (or node code) as a parameter, use the ICatalogSystem to find that node and then pass the node ID to the CatalogSystemEntries iterator to iterate just the entries under that node.</p>
<h2>Iterators</h2>
<p>We have four iterators in use:</p>
<ol>
<li>CatalogSystemCatalogs - iterates through all catalogs</li>
<li>CatalogSystemNodes - iterates through all nodes, in a breadth-first fashion, in a catalog</li>
<li>CatalogSystemEntries - iterates through all entries in a node</li>
<li>CatalogSystemEntryMetaObjects - iterates through all MetaObjects for an entry</li>
</ol>
<h3>CatalogSystemCatalogs Iterator</h3>
<p>The code is pretty simple. We implement an IEnumerable which uses our implementation of an IEnumerator.</p>
<p>The IEnumerator simply gets all the catalogs from the ICatalogSystem and, as you call MoveNext() (usually done for you by the foreach loop), increments an index value to give you the current CatalogDto.CatalogRow to work with.</p>
<div class="remark-highlight"><pre class="language-csharp"><code class="language-csharp"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CatalogSystemCatalogs</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IEnumerable<span class="token punctuation">&#x3C;</span>CatalogDto<span class="token punctuation">.</span>CatalogRow<span class="token punctuation">></span></span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">readonly</span> <span class="token class-name">CatalogSystemCatalogEnumerator</span> _enumerator<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token function">CatalogSystemCatalogs</span><span class="token punctuation">(</span><span class="token class-name">ICatalogSystem</span> catalogSystem<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        _enumerator <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">CatalogSystemCatalogEnumerator</span><span class="token punctuation">(</span>catalogSystem<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token return-type class-name">IEnumerator<span class="token punctuation">&#x3C;</span>CatalogDto<span class="token punctuation">.</span>CatalogRow<span class="token punctuation">></span></span> <span class="token function">GetEnumerator</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> _enumerator<span class="token punctuation">;</span>

    <span class="token return-type class-name">IEnumerator</span> IEnumerable<span class="token punctuation">.</span><span class="token function">GetEnumerator</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> _enumerator<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CatalogSystemCatalogEnumerator</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IEnumerator<span class="token punctuation">&#x3C;</span>CatalogDto<span class="token punctuation">.</span>CatalogRow<span class="token punctuation">></span></span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name"><span class="token keyword">int</span></span> _currentIndex <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">readonly</span> <span class="token class-name">ICatalogSystem</span> _catalogSystem<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Lazy<span class="token punctuation">&#x3C;</span>Lst<span class="token punctuation">&#x3C;</span>CatalogDto<span class="token punctuation">.</span>CatalogRow<span class="token punctuation">></span><span class="token punctuation">></span></span> _catalogs<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token function">CatalogSystemCatalogEnumerator</span><span class="token punctuation">(</span><span class="token class-name">ICatalogSystem</span> catalogSystem<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        _catalogSystem <span class="token operator">=</span> catalogSystem<span class="token punctuation">;</span>
        _catalogs <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Lazy<span class="token punctuation">&#x3C;</span>Lst<span class="token punctuation">&#x3C;</span>CatalogDto<span class="token punctuation">.</span>CatalogRow<span class="token punctuation">></span><span class="token punctuation">></span></span><span class="token punctuation">(</span>GetCatalogs<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token return-type class-name">CatalogDto<span class="token punctuation">.</span>CatalogRow</span> Current
    <span class="token punctuation">{</span>
        <span class="token keyword">get</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">return</span> _catalogs<span class="token punctuation">.</span>Value<span class="token punctuation">[</span>_currentIndex<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token return-type class-name"><span class="token keyword">object</span></span> IEnumerator<span class="token punctuation">.</span>Current <span class="token operator">=></span> Current<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token function">Reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> <span class="token function">MoveNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>_catalogs<span class="token punctuation">.</span>IsValueCreated<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            _currentIndex<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>_currentIndex <span class="token operator">>=</span> _catalogs<span class="token punctuation">.</span>Value<span class="token punctuation">.</span>Count<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        _catalogs <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Lazy<span class="token punctuation">&#x3C;</span>Lst<span class="token punctuation">&#x3C;</span>CatalogDto<span class="token punctuation">.</span>CatalogRow<span class="token punctuation">></span><span class="token punctuation">></span></span><span class="token punctuation">(</span>GetCatalogs<span class="token punctuation">)</span><span class="token punctuation">;</span>
        _currentIndex <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token return-type class-name">Lst<span class="token punctuation">&#x3C;</span>CatalogDto<span class="token punctuation">.</span>CatalogRow<span class="token punctuation">></span></span> <span class="token function">GetCatalogs</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token operator">=></span> _catalogSystem<span class="token punctuation">.</span><span class="token function">GetCatalogDto</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Catalog<span class="token punctuation">.</span><span class="token function">Freeze</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div>
<h3>CatalogSystemNodes Iterator</h3>
<p>For the nodes iterator, things get a little more complicated. Nodes can be nested, so we have tree structure we have to navigate. We use a Queue to walk through the nodes in a breadth-first fashion.</p>
<p>I like to use as many functional programming techniques as I can in C# these days. I use the great <a href="https://github.com/louthy/language-ext">LanguageExt</a> library for this. This library is where the <code>Que&#x3C;T></code>, <code>Option&#x3C;T></code> and <code>Lst&#x3C;T></code> data structures come from. I don't want to go in depth about what they are, but to understand the code below, you should now this: <code>Que&#x3C;T></code> is an immutable <code>Queue&#x3C;T></code>, <code>Lst&#x3C;T></code> is an immutable <code>List&#x3C;T></code> and <code>Option&#x3C;T></code> is basically the functional way to do the null-object pattern (instead of dealing with nulls, use an object to represent "I don't have a value").</p>
<p>If you're not familiar with breadth-first tree traversals, it's not too complicated. What we do first is get all the nodes at the top level (in our case, all the nodes that are direct children of the catalog we pass in) and put them in the queue. Then, we iterate through each of the nodes we put in the queue and add their child nodes to the queue. We do this until we run out of nodes to process in the queue which indicates we've gone through all nodes in the tree.</p>
<div class="remark-highlight"><pre class="language-csharp"><code class="language-csharp"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CatalogSystemNodes</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IEnumerable<span class="token punctuation">&#x3C;</span>CatalogNodeDto<span class="token punctuation">.</span>CatalogNodeRow<span class="token punctuation">></span></span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">readonly</span> <span class="token class-name">CatalogSystemNodeEnumerator</span> _enumerator<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token function">CatalogSystemNodes</span><span class="token punctuation">(</span><span class="token class-name">ICatalogSystem</span> catalogSystem<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">int</span></span> catalogId<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">int</span></span> startingParentNodeId <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        _enumerator <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">CatalogSystemNodeEnumerator</span><span class="token punctuation">(</span>catalogSystem<span class="token punctuation">,</span> catalogId<span class="token punctuation">,</span> startingParentNodeId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token return-type class-name">IEnumerator<span class="token punctuation">&#x3C;</span>CatalogNodeDto<span class="token punctuation">.</span>CatalogNodeRow<span class="token punctuation">></span></span> <span class="token function">GetEnumerator</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> _enumerator<span class="token punctuation">;</span>

    <span class="token return-type class-name">IEnumerator</span> IEnumerable<span class="token punctuation">.</span><span class="token function">GetEnumerator</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> _enumerator<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CatalogSystemNodeEnumerator</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IEnumerator<span class="token punctuation">&#x3C;</span>CatalogNodeDto<span class="token punctuation">.</span>CatalogNodeRow<span class="token punctuation">></span></span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">Que<span class="token punctuation">&#x3C;</span><span class="token keyword">int</span><span class="token punctuation">></span></span> _nodeQue<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">readonly</span> <span class="token class-name">ICatalogSystem</span> _catalogSystem<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">readonly</span> <span class="token class-name"><span class="token keyword">int</span></span> _catalogId<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">readonly</span> <span class="token class-name"><span class="token keyword">int</span></span> _startingParentNodeId<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Option<span class="token punctuation">&#x3C;</span>CatalogNodeDto<span class="token punctuation">.</span>CatalogNodeRow<span class="token punctuation">></span></span> _current<span class="token punctuation">;</span>

    <span class="token comment">// We have a parameter for the starting node ID (startingParentNodeId) which defaults to 0.  If you</span>
    <span class="token comment">// pass in a node ID, we'll start iterating child nodes of that node.  If you don't pass a value (keep</span>
    <span class="token comment">// the default of 0), then we'll iterate through all nodes in the catalog.</span>
    <span class="token keyword">public</span> <span class="token function">CatalogSystemNodeEnumerator</span><span class="token punctuation">(</span><span class="token class-name">ICatalogSystem</span> catalogSystem<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">int</span></span> catalogId<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">int</span></span> startingParentNodeId <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        _catalogSystem <span class="token operator">=</span> catalogSystem<span class="token punctuation">;</span>
        _catalogId <span class="token operator">=</span> catalogId<span class="token punctuation">;</span>
        _startingParentNodeId <span class="token operator">=</span> startingParentNodeId<span class="token punctuation">;</span>
        _nodeQue <span class="token operator">=</span> Prelude<span class="token punctuation">.</span><span class="token function">Queue</span><span class="token punctuation">(</span>_startingParentNodeId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        _current <span class="token operator">=</span> Option<span class="token operator">&#x3C;</span>CatalogNodeDto<span class="token punctuation">.</span>CatalogNodeRow<span class="token operator">></span><span class="token punctuation">.</span>None<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// ValueUnsafe() lets us get the value of _current (which is an Option&#x3C;T>)</span>
    <span class="token comment">// or null if the Option&#x3C;T> has no value.</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">CatalogNodeDto<span class="token punctuation">.</span>CatalogNodeRow</span> Current <span class="token operator">=></span> _current<span class="token punctuation">.</span><span class="token function">ValueUnsafe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token return-type class-name"><span class="token keyword">object</span></span> IEnumerator<span class="token punctuation">.</span>Current <span class="token operator">=></span> Current<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token function">Reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> <span class="token function">MoveNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// end-case scenario--we've run out of nodes in the queue, so we're</span>
        <span class="token comment">// done traversing the node tree</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>_nodeQue<span class="token punctuation">.</span><span class="token function">Any</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token class-name"><span class="token keyword">int</span></span> nextNodeId <span class="token operator">=</span> <span class="token function">GetNextNodeIdAndUpdateQue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// special starting condition when we want to do the entire tree</span>
        <span class="token comment">// and no other starting node was passed in</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>nextNodeId <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token comment">// special case of there being a catalog node with no category nodes beneath it</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>_nodeQue<span class="token punctuation">.</span><span class="token function">Any</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            nextNodeId <span class="token operator">=</span> <span class="token function">GetNextNodeIdAndUpdateQue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        _current <span class="token operator">=</span> <span class="token function">GetNode</span><span class="token punctuation">(</span>nextNodeId<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> _current<span class="token punctuation">.</span>IsSome<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> <span class="token function">GetNextNodeIdAndUpdateQue</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// get the next node ID from the queue</span>
        <span class="token class-name"><span class="token keyword">int</span></span> nextNodeId <span class="token operator">=</span> _nodeQue<span class="token punctuation">.</span><span class="token function">Peek</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// remove the retrieved node from the queue</span>
        _nodeQue <span class="token operator">=</span> _nodeQue<span class="token punctuation">.</span><span class="token function">Dequeue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// get all of this node's children and add their IDs to the queue</span>
        _nodeQue <span class="token operator">=</span> <span class="token function">GetChildren</span><span class="token punctuation">(</span>nextNodeId<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">Fold</span><span class="token punctuation">(</span>_nodeQue<span class="token punctuation">,</span> <span class="token punctuation">(</span>q<span class="token punctuation">,</span> nodeRow<span class="token punctuation">)</span> <span class="token operator">=></span> q<span class="token punctuation">.</span><span class="token function">Enqueue</span><span class="token punctuation">(</span>nodeRow<span class="token punctuation">.</span>CatalogNodeId<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> nextNodeId<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token return-type class-name">Option<span class="token punctuation">&#x3C;</span>CatalogNodeDto<span class="token punctuation">.</span>CatalogNodeRow<span class="token punctuation">></span></span> <span class="token function">GetNode</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> nodeId<span class="token punctuation">)</span>
        <span class="token operator">=></span> _catalogSystem<span class="token punctuation">.</span><span class="token function">GetCatalogNodeDto</span><span class="token punctuation">(</span>nodeId<span class="token punctuation">)</span><span class="token punctuation">.</span>CatalogNode<span class="token punctuation">.</span><span class="token function">HeadOrNone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token return-type class-name">Lst<span class="token punctuation">&#x3C;</span>CatalogNodeDto<span class="token punctuation">.</span>CatalogNodeRow<span class="token punctuation">></span></span> <span class="token function">GetChildren</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> nodeId<span class="token punctuation">)</span>
        <span class="token operator">=></span> _catalogSystem<span class="token punctuation">.</span><span class="token function">GetCatalogNodesDto</span><span class="token punctuation">(</span>_catalogId<span class="token punctuation">,</span> nodeId<span class="token punctuation">)</span><span class="token punctuation">.</span>CatalogNode<span class="token punctuation">.</span><span class="token function">Freeze</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        _nodeQue <span class="token operator">=</span> Prelude<span class="token punctuation">.</span><span class="token function">Queue</span><span class="token punctuation">(</span>_startingParentNodeId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        _current <span class="token operator">=</span> Option<span class="token operator">&#x3C;</span>CatalogNodeDto<span class="token punctuation">.</span>CatalogNodeRow<span class="token operator">></span><span class="token punctuation">.</span>None<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div>
<h3>CatalogSystemEntries Iterator</h3>
<p>Since entries cannot be arrange in a nested fashion, this iterator is a little less complicated than the nodes iterator. All we do is take in a catalogId and a catalogNodeId and retrieve all the entries below the given node ID, passing them to you one at a time as you call MoveNext().</p>
<p>The only mildly complex thing here is that we use a <code>Lazy&#x3C;T></code> so that we're not retrieving the entries immediately when you instanstiate the IEnumerator. We only load the entries when you MoveNext() and access Current which indicates you really do want some entries.</p>
<div class="remark-highlight"><pre class="language-csharp"><code class="language-csharp"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CatalogSystemEntries</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IEnumerable<span class="token punctuation">&#x3C;</span>CatalogEntryDto<span class="token punctuation">.</span>CatalogEntryRow<span class="token punctuation">></span></span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">readonly</span> <span class="token class-name">CatalogSystemEntryEnumerator</span> _enumerator<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token function">CatalogSystemEntries</span><span class="token punctuation">(</span><span class="token class-name">ICatalogSystem</span> catalogSystem<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">int</span></span> catalogId<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">int</span></span> catalogNodeId<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        _enumerator <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">CatalogSystemEntryEnumerator</span><span class="token punctuation">(</span>catalogSystem<span class="token punctuation">,</span> catalogId<span class="token punctuation">,</span> catalogNodeId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token return-type class-name">IEnumerator<span class="token punctuation">&#x3C;</span>CatalogEntryDto<span class="token punctuation">.</span>CatalogEntryRow<span class="token punctuation">></span></span> <span class="token function">GetEnumerator</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> _enumerator<span class="token punctuation">;</span>

    <span class="token return-type class-name">IEnumerator</span> IEnumerable<span class="token punctuation">.</span><span class="token function">GetEnumerator</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> _enumerator<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CatalogSystemEntryEnumerator</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IEnumerator<span class="token punctuation">&#x3C;</span>CatalogEntryDto<span class="token punctuation">.</span>CatalogEntryRow<span class="token punctuation">></span></span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name"><span class="token keyword">int</span></span> _currentIndex <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">readonly</span> <span class="token class-name">ICatalogSystem</span> _catalogSystem<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Lazy<span class="token punctuation">&#x3C;</span>Lst<span class="token punctuation">&#x3C;</span>CatalogEntryDto<span class="token punctuation">.</span>CatalogEntryRow<span class="token punctuation">></span><span class="token punctuation">></span></span> _entries<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">readonly</span> <span class="token class-name"><span class="token keyword">int</span></span> _catalogNodeId<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">readonly</span> <span class="token class-name"><span class="token keyword">int</span></span> _catalogId<span class="token punctuation">;</span>

    <span class="token comment">// we take in the catalogNodeId to start at so that you could use this IEnumerator</span>
    <span class="token comment">// to collect entries at any starting node in the catalog.</span>
    <span class="token keyword">public</span> <span class="token function">CatalogSystemEntryEnumerator</span><span class="token punctuation">(</span><span class="token class-name">ICatalogSystem</span> catalogSystem<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">int</span></span> catalogId<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">int</span></span> catalogNodeId<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        _catalogSystem <span class="token operator">=</span> catalogSystem<span class="token punctuation">;</span>
        <span class="token comment">// we use a Lazy&#x3C;T> object here so that we don't do a database call</span>
        <span class="token comment">// as soon as you instantiate this class.  We only do it once you</span>
        <span class="token comment">// access Current, indicating you really want to iterate the entries now</span>
        _entries <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Lazy<span class="token punctuation">&#x3C;</span>Lst<span class="token punctuation">&#x3C;</span>CatalogEntryDto<span class="token punctuation">.</span>CatalogEntryRow<span class="token punctuation">></span><span class="token punctuation">></span></span><span class="token punctuation">(</span>GetEntries<span class="token punctuation">)</span><span class="token punctuation">;</span>
        _catalogNodeId <span class="token operator">=</span> catalogNodeId<span class="token punctuation">;</span>
        _catalogId <span class="token operator">=</span> catalogId<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token return-type class-name">CatalogEntryDto<span class="token punctuation">.</span>CatalogEntryRow</span> Current
    <span class="token punctuation">{</span>
        <span class="token keyword">get</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">return</span> _entries<span class="token punctuation">.</span>Value<span class="token punctuation">[</span>_currentIndex<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token return-type class-name"><span class="token keyword">object</span></span> IEnumerator<span class="token punctuation">.</span>Current <span class="token operator">=></span> Current<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token function">Reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> <span class="token function">MoveNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// the first MoveNext() call will be when when _entries doesn't have</span>
        <span class="token comment">// a value yet (but will after Current is accessed).  So, this leaves</span>
        <span class="token comment">// the _currentIndex at 0 the first time MoveNext() is called.</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>_entries<span class="token punctuation">.</span>IsValueCreated<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            _currentIndex<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// we just incremented _currentIndex to the count of the _entries list,</span>
        <span class="token comment">// so we return false to indicate there are no more values.  We really could</span>
        <span class="token comment">// use == here instead of >=.  I guess >= feels safer for some reason.</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>_currentIndex <span class="token operator">>=</span> _entries<span class="token punctuation">.</span>Value<span class="token punctuation">.</span>Count<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        _entries <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Lazy<span class="token punctuation">&#x3C;</span>Lst<span class="token punctuation">&#x3C;</span>CatalogEntryDto<span class="token punctuation">.</span>CatalogEntryRow<span class="token punctuation">></span><span class="token punctuation">></span></span><span class="token punctuation">(</span>GetEntries<span class="token punctuation">)</span><span class="token punctuation">;</span>
        _currentIndex <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token return-type class-name">Lst<span class="token punctuation">&#x3C;</span>CatalogEntryDto<span class="token punctuation">.</span>CatalogEntryRow<span class="token punctuation">></span></span> <span class="token function">GetEntries</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token operator">=></span> _catalogSystem<span class="token punctuation">.</span><span class="token function">GetCatalogEntriesDto</span><span class="token punctuation">(</span>_catalogId<span class="token punctuation">,</span> _catalogNodeId<span class="token punctuation">)</span><span class="token punctuation">.</span>CatalogEntry<span class="token punctuation">.</span><span class="token function">Freeze</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div>
<h3>CatalogSystemEntryMetaObjects Iterator</h3>
<p>The MetaObjects iterator is a different than the other iterators in that it doesn't really iterate through a list or tree of MetaObjects. Instead, it iterates through all fo the MetaObject instances for a particular entry--one instance for reach culture available for the catalog.</p>
<p>So, as you'll see in the code below, one of the first things we do is grab all of the languages for the catalog so that we know what we need to interate through.</p>
<div class="remark-highlight"><pre class="language-csharp"><code class="language-csharp"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CatalogSystemEntryMetaObjects</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IEnumerable<span class="token punctuation">&#x3C;</span><span class="token punctuation">(</span>MetaObject metaObject<span class="token punctuation">,</span> MetaDataContext metaDataContext<span class="token punctuation">)</span><span class="token punctuation">></span></span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">readonly</span> <span class="token class-name">CatalogSystemEntryMetaObjectsEnumerator</span> _enumerator<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token function">CatalogSystemEntryMetaObjects</span><span class="token punctuation">(</span><span class="token class-name">MetaDataContext</span> metaDataContext<span class="token punctuation">,</span> <span class="token class-name">CatalogDto<span class="token punctuation">.</span>CatalogRow</span> catalog<span class="token punctuation">,</span> <span class="token class-name">CatalogEntryDto<span class="token punctuation">.</span>CatalogEntryRow</span> entry<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        _enumerator <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">CatalogSystemEntryMetaObjectsEnumerator</span><span class="token punctuation">(</span>metaDataContext<span class="token punctuation">,</span> catalog<span class="token punctuation">,</span> entry<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token return-type class-name">IEnumerator<span class="token punctuation">&#x3C;</span><span class="token punctuation">(</span>MetaObject metaObject<span class="token punctuation">,</span> MetaDataContext metaDataContext<span class="token punctuation">)</span><span class="token punctuation">></span></span> <span class="token function">GetEnumerator</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> _enumerator<span class="token punctuation">;</span>

    <span class="token return-type class-name">IEnumerator</span> IEnumerable<span class="token punctuation">.</span><span class="token function">GetEnumerator</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> _enumerator<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CatalogSystemEntryMetaObjectsEnumerator</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IEnumerator<span class="token punctuation">&#x3C;</span><span class="token punctuation">(</span>MetaObject metaObject<span class="token punctuation">,</span> MetaDataContext metaDataContext<span class="token punctuation">)</span><span class="token punctuation">></span></span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name"><span class="token keyword">int</span></span> _currentIndex <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">readonly</span> <span class="token class-name">CatalogEntryDto<span class="token punctuation">.</span>CatalogEntryRow</span> _entry<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">readonly</span> <span class="token class-name">MetaDataContext</span> _metaDataContext<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Lazy<span class="token punctuation">&#x3C;</span>Lst<span class="token punctuation">&#x3C;</span>CultureInfo<span class="token punctuation">></span><span class="token punctuation">></span></span> _catalogLanguages<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">readonly</span> <span class="token class-name">CatalogDto<span class="token punctuation">.</span>CatalogRow</span> _catalog<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token function">CatalogSystemEntryMetaObjectsEnumerator</span><span class="token punctuation">(</span><span class="token class-name">MetaDataContext</span> metaDataContext<span class="token punctuation">,</span>
        <span class="token class-name">CatalogDto<span class="token punctuation">.</span>CatalogRow</span> catalog<span class="token punctuation">,</span>
        <span class="token class-name">CatalogEntryDto<span class="token punctuation">.</span>CatalogEntryRow</span> entry<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        _catalog <span class="token operator">=</span> catalog<span class="token punctuation">;</span>
        _entry <span class="token operator">=</span> entry<span class="token punctuation">;</span>
        _metaDataContext <span class="token operator">=</span> metaDataContext<span class="token punctuation">;</span>
        _catalogLanguages <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Lazy<span class="token punctuation">&#x3C;</span>Lst<span class="token punctuation">&#x3C;</span>CultureInfo<span class="token punctuation">></span><span class="token punctuation">></span></span><span class="token punctuation">(</span>GetCatalogLanguages<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token punctuation">(</span>MetaObject metaObject<span class="token punctuation">,</span> MetaDataContext metaDataContext<span class="token punctuation">)</span></span> Current
    <span class="token punctuation">{</span>
        <span class="token keyword">get</span>
        <span class="token punctuation">{</span>
            <span class="token comment">// what we're really iterating through is the catalog languages.</span>
            <span class="token comment">// as we iterate through them, we grab the associate MetaObject for the current</span>
            <span class="token comment">// language for the given entry</span>
            <span class="token class-name">CultureInfo</span> currentCultureInfo <span class="token operator">=</span> _catalogLanguages<span class="token punctuation">.</span>Value<span class="token punctuation">[</span>_currentIndex<span class="token punctuation">]</span><span class="token punctuation">;</span>

            <span class="token class-name"><span class="token keyword">var</span></span> mdc <span class="token operator">=</span> _metaDataContext<span class="token punctuation">.</span><span class="token function">Clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            mdc<span class="token punctuation">.</span>UseCurrentThreadCulture <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            mdc<span class="token punctuation">.</span>Language <span class="token operator">=</span> currentCultureInfo<span class="token punctuation">.</span>Name<span class="token punctuation">;</span>

            <span class="token keyword">return</span> <span class="token punctuation">(</span>MetaObject<span class="token punctuation">.</span><span class="token function">Load</span><span class="token punctuation">(</span>mdc<span class="token punctuation">,</span> _entry<span class="token punctuation">.</span>CatalogEntryId<span class="token punctuation">,</span> _entry<span class="token punctuation">.</span>MetaClassId<span class="token punctuation">)</span><span class="token punctuation">,</span> mdc<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token return-type class-name"><span class="token keyword">object</span></span> IEnumerator<span class="token punctuation">.</span>Current <span class="token operator">=></span> Current<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token function">Reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> <span class="token function">MoveNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// As with the Lazy&#x3C;T> for iterating through the entries, the first tie MoveNext() is called</span>
        <span class="token comment">// the _catalogLanguages Lazy&#x3C;T> will not have a value.  It will after the first Current access.</span>
        <span class="token comment">// So, for the first MoveNext(), we want to keep the _currentIndex at 0, which is what this if-statement</span>
        <span class="token comment">// accomplishes.</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>_catalogLanguages<span class="token punctuation">.</span>IsValueCreated<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            _currentIndex<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>_currentIndex <span class="token operator">>=</span> _catalogLanguages<span class="token punctuation">.</span>Value<span class="token punctuation">.</span>Count<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        _catalogLanguages <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Lazy<span class="token punctuation">&#x3C;</span>Lst<span class="token punctuation">&#x3C;</span>CultureInfo<span class="token punctuation">></span><span class="token punctuation">></span></span><span class="token punctuation">(</span>GetCatalogLanguages<span class="token punctuation">)</span><span class="token punctuation">;</span>
        _currentIndex <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token return-type class-name">Lst<span class="token punctuation">&#x3C;</span>CultureInfo<span class="token punctuation">></span></span> <span class="token function">GetCatalogLanguages</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token operator">=></span> _catalog<span class="token punctuation">.</span><span class="token function">GetCatalogLanguageRows</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">Map</span><span class="token punctuation">(</span>lr <span class="token operator">=></span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">CultureInfo</span><span class="token punctuation">(</span>lr<span class="token punctuation">.</span>LanguageCode<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">Freeze</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div>
<h2>Warning</h2>
<p>Even though the above code will give you the convenience of iterating through your entire EPiServer catalog(s), be warned! You could easily forget what the IEnumerators really do above and do something like this:</p>
<div class="remark-highlight"><pre class="language-csharp"><code class="language-csharp"><span class="token comment">// REALLY BAD CODE, DON'T DO</span>
<span class="token class-name">List<span class="token punctuation">&#x3C;</span><span class="token punctuation">(</span>MetaObject metaObject<span class="token punctuation">,</span> MetaDataContext mdc<span class="token punctuation">)</span><span class="token punctuation">></span></span> allTheMetaObjects <span class="token operator">=</span> _catalogSystem<span class="token punctuation">.</span><span class="token function">AllCatalogSystemEntryMetaObjects</span><span class="token punctuation">(</span>mdc<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
<p>I hope you see the danger of this. If you have a large catalog, you're loading the ENTIRE set of MetaObjects into memory in your <code>allTheMetaObjects</code> list. This probably won't be good for your application. If you have a small catalog, this might not be a big deal. But, keep this in mind!</p>
</div></article><section class="comments"><a id="comments-section"><h2>Comments</h2></a><div id="disqus_thread"></div></section></div></main><footer class="footer"><div class="container"><hr/><small> <time dateTime="2023-01-16T00:01:33.261Z">2023</time>. All rights reserved.</small></div><script async="" defer="" data-website-id="b5832ded-a501-4aab-b4ce-ef0373a1a887" src="https://umami.benramey.com/umami.js"></script></footer></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"tags":["episerver","csharp","dotnet"],"categories":["programming"],"title":"Iterating All EPiServer Catalog MetaObjects","contentHtml":"\u003cp\u003eIf you're maintaining an e-commerce-enabled site in EPiServer and you're using the built-in catalog, then\nyou have probably found the need to incorporate external data into the catalog, perhaps from various sources.\u003c/p\u003e\n\u003cp\u003eSuch is the case for me on an EPiServer site I've been working on over the last (almost) four years. The primary\ndata for the catalog comes into EPiServer from an external PIM system. But, then there is all sorts of ancillary\ndata that needs to calculated from existing fields or pulled from external sources. These external data sources\ndon't really provide a way to incrementally apply deltas for the data they provide. The only option to make updates is to walk\nthrough the entire catalog and see if anything needs updating when matched against the external data I've pulled.\u003c/p\u003e\n\u003cp\u003eThis external data is stored in the catalog as custom EPiServer MetaFields. So,\na need arose to easily walk through the entire catalog, pick up every MetaObject (to update the custom MetaFields)\nin every available catalog culture and make the appropriate updates.\u003c/p\u003e\n\u003cp\u003eBelow are the iterators I wrote to accomplish this. They let you walk the entire catalog tree (in a breadth-first manner)\nstarting from the top as if you were iterating a simple C# array or list.\u003c/p\u003e\n\u003ch2\u003eHigh-Level Usage\u003c/h2\u003e\n\u003cp\u003eBecause all we're doing is writing iterators, the high-level usage looks just like you were interating through\nan \u003ccode\u003eIEnumerable\u003c/code\u003e in C# like an array or a \u003ccode\u003eList\u0026#x3C;T\u003e\u003c/code\u003e.\u003c/p\u003e\n\u003cp\u003eThe iterators are implemented as extension methods on the \u003ccode\u003eICatalogSystem\u003c/code\u003e interface. So, iterating through all\nof the catalog entry MetaObjects looks like this.\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-csharp\"\u003e\u003ccode class=\"language-csharp\"\u003e\u003cspan class=\"token keyword\"\u003eusing\u003c/span\u003e \u003cspan class=\"token namespace\"\u003eMediachase\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eCommerce\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eCatalog\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003eusing\u003c/span\u003e \u003cspan class=\"token namespace\"\u003eMediachase\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eMetaDataPlus\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"token class-name\"\u003eICatalogSystem\u003c/span\u003e catalog \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e CatalogContext\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eCurrent\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token class-name\"\u003eMetaDataContext\u003c/span\u003e mdc \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e MetaDataContext\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eInstance\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003eforeach\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token class-name\"\u003eMetaObject\u003c/span\u003e metaObject\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eMetaDataContext\u003c/span\u003e metaDataContext\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e entryMO \u003cspan class=\"token keyword\"\u003ein\u003c/span\u003e catalog\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eAllCatalogSystemEntryMetaObjects\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003emdc\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    entryMO\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003emetaObject\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"SomeCustomMetaFieldName\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"external data source value here\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    entryMO\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003emetaObject\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eAcceptChanges\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eentryMO\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003emetaDataContext\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eI implemented the separate iterators for NodeContent MetaObjects and the EntryContent\nMetaObjects. You easily use them in combination to iterate through the MetaObjects of the entire catalog tree.\u003c/p\u003e\n\u003cp\u003eNote a couple of things from the example code above:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eYou have to give the iterator the MetaDataContext. As we'll see in the iterator code, it will copy this MDC for each catalog language so that you get a MetaObject for every culture present in your catalog.\u003c/li\u003e\n\u003cli\u003eBecause of #1 above, the current MetaDataContext is passed to you during iteration so that you know which catalog culture this MetaObject is for.\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2\u003eExtension Method Code\u003c/h2\u003e\n\u003cp\u003eThe extension method code for AllCatalogSystemEntryMetaObjects is pretty simple. It uses four iterators in nested foreach loops to loop through\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eAll catalogs\u003c/li\u003e\n\u003cli\u003eAll nodes\u003c/li\u003e\n\u003cli\u003eAll entries\u003c/li\u003e\n\u003cli\u003eAll meta objects\u003c/li\u003e\n\u003c/ol\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-csharp\"\u003e\u003ccode class=\"language-csharp\"\u003e\u003cspan class=\"token keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"token keyword\"\u003estatic\u003c/span\u003e \u003cspan class=\"token return-type class-name\"\u003eIEnumerable\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eMetaObject metaObject\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e MetaDataContext metaDataContext\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token function\"\u003eAllCatalogSystemEntryMetaObjects\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eICatalogSystem\u003c/span\u003e catalogSystem\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"token class-name\"\u003eMetaDataContext\u003c/span\u003e metaDataContext\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003eforeach\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token class-name\"\u003e\u003cspan class=\"token keyword\"\u003evar\u003c/span\u003e\u003c/span\u003e catalog \u003cspan class=\"token keyword\"\u003ein\u003c/span\u003e \u003cspan class=\"token keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"token constructor-invocation class-name\"\u003eCatalogSystemCatalogs\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ecatalogSystem\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003eforeach\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token class-name\"\u003e\u003cspan class=\"token keyword\"\u003evar\u003c/span\u003e\u003c/span\u003e node \u003cspan class=\"token keyword\"\u003ein\u003c/span\u003e \u003cspan class=\"token keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"token constructor-invocation class-name\"\u003eCatalogSystemNodes\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ecatalogSystem\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e catalog\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eCatalogId\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"token keyword\"\u003eforeach\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token class-name\"\u003e\u003cspan class=\"token keyword\"\u003evar\u003c/span\u003e\u003c/span\u003e entry \u003cspan class=\"token keyword\"\u003ein\u003c/span\u003e \u003cspan class=\"token keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"token constructor-invocation class-name\"\u003eCatalogSystemEntries\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ecatalogSystem\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e catalog\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eCatalogId\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e node\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eCatalogNodeId\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"token keyword\"\u003eforeach\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token class-name\"\u003e\u003cspan class=\"token keyword\"\u003evar\u003c/span\u003e\u003c/span\u003e tuple \u003cspan class=\"token keyword\"\u003ein\u003c/span\u003e \u003cspan class=\"token keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"token constructor-invocation class-name\"\u003eCatalogSystemEntryMetaObjects\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003emetaDataContext\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e catalog\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e entry\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n                \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n                    \u003cspan class=\"token keyword\"\u003eyield\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e tuple\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n                \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n            \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eI broke the iteration down into separate iterators in this fashion so that I could easily iterate through all the entries (for example) in a single node, if I knew from the beginning which node I wanted to start at. If that was the case, I could easily write another extension method that took a node ID (or node code) as a parameter, use the ICatalogSystem to find that node and then pass the node ID to the CatalogSystemEntries iterator to iterate just the entries under that node.\u003c/p\u003e\n\u003ch2\u003eIterators\u003c/h2\u003e\n\u003cp\u003eWe have four iterators in use:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eCatalogSystemCatalogs - iterates through all catalogs\u003c/li\u003e\n\u003cli\u003eCatalogSystemNodes - iterates through all nodes, in a breadth-first fashion, in a catalog\u003c/li\u003e\n\u003cli\u003eCatalogSystemEntries - iterates through all entries in a node\u003c/li\u003e\n\u003cli\u003eCatalogSystemEntryMetaObjects - iterates through all MetaObjects for an entry\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch3\u003eCatalogSystemCatalogs Iterator\u003c/h3\u003e\n\u003cp\u003eThe code is pretty simple. We implement an IEnumerable which uses our implementation of an IEnumerator.\u003c/p\u003e\n\u003cp\u003eThe IEnumerator simply gets all the catalogs from the ICatalogSystem and, as you call MoveNext() (usually done for you by the foreach loop), increments an index value to give you the current CatalogDto.CatalogRow to work with.\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-csharp\"\u003e\u003ccode class=\"language-csharp\"\u003e\u003cspan class=\"token keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eCatalogSystemCatalogs\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token type-list\"\u003e\u003cspan class=\"token class-name\"\u003eIEnumerable\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003eCatalogDto\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eCatalogRow\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003eprivate\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eCatalogSystemCatalogEnumerator\u003c/span\u003e _enumerator\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"token keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"token function\"\u003eCatalogSystemCatalogs\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token class-name\"\u003eICatalogSystem\u003c/span\u003e catalogSystem\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        _enumerator \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"token constructor-invocation class-name\"\u003eCatalogSystemCatalogEnumerator\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ecatalogSystem\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"token keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"token return-type class-name\"\u003eIEnumerator\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003eCatalogDto\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eCatalogRow\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token function\"\u003eGetEnumerator\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003e\u003c/span\u003e _enumerator\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"token return-type class-name\"\u003eIEnumerator\u003c/span\u003e IEnumerable\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eGetEnumerator\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003e\u003c/span\u003e _enumerator\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eCatalogSystemCatalogEnumerator\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token type-list\"\u003e\u003cspan class=\"token class-name\"\u003eIEnumerator\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003eCatalogDto\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eCatalogRow\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003eprivate\u003c/span\u003e \u003cspan class=\"token class-name\"\u003e\u003cspan class=\"token keyword\"\u003eint\u003c/span\u003e\u003c/span\u003e _currentIndex \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003eprivate\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eICatalogSystem\u003c/span\u003e _catalogSystem\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003eprivate\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eLazy\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003eLst\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003eCatalogDto\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eCatalogRow\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e _catalogs\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"token keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"token function\"\u003eCatalogSystemCatalogEnumerator\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token class-name\"\u003eICatalogSystem\u003c/span\u003e catalogSystem\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        _catalogSystem \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e catalogSystem\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n        _catalogs \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"token constructor-invocation class-name\"\u003eLazy\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003eLst\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003eCatalogDto\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eCatalogRow\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eGetCatalogs\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"token keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"token return-type class-name\"\u003eCatalogDto\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eCatalogRow\u003c/span\u003e Current\n    \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003eget\u003c/span\u003e\n        \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e _catalogs\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eValue\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e_currentIndex\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"token return-type class-name\"\u003e\u003cspan class=\"token keyword\"\u003eobject\u003c/span\u003e\u003c/span\u003e IEnumerator\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eCurrent \u003cspan class=\"token operator\"\u003e=\u003e\u003c/span\u003e Current\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"token keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"token return-type class-name\"\u003e\u003cspan class=\"token keyword\"\u003evoid\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token function\"\u003eDispose\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"token function\"\u003eReset\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"token keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"token return-type class-name\"\u003e\u003cspan class=\"token keyword\"\u003ebool\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token function\"\u003eMoveNext\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e_catalogs\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eIsValueCreated\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n            _currentIndex\u003cspan class=\"token operator\"\u003e++\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e_currentIndex \u003cspan class=\"token operator\"\u003e\u003e=\u003c/span\u003e _catalogs\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eValue\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eCount\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token boolean\"\u003efalse\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token boolean\"\u003etrue\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"token keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"token return-type class-name\"\u003e\u003cspan class=\"token keyword\"\u003evoid\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token function\"\u003eReset\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        _catalogs \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"token constructor-invocation class-name\"\u003eLazy\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003eLst\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003eCatalogDto\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eCatalogRow\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eGetCatalogs\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n        _currentIndex \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"token keyword\"\u003eprivate\u003c/span\u003e \u003cspan class=\"token return-type class-name\"\u003eLst\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003eCatalogDto\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eCatalogRow\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token function\"\u003eGetCatalogs\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"token operator\"\u003e=\u003e\u003c/span\u003e _catalogSystem\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eGetCatalogDto\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eCatalog\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eFreeze\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch3\u003eCatalogSystemNodes Iterator\u003c/h3\u003e\n\u003cp\u003eFor the nodes iterator, things get a little more complicated. Nodes can be nested, so we have tree structure we have to navigate. We use a Queue to walk through the nodes in a breadth-first fashion.\u003c/p\u003e\n\u003cp\u003eI like to use as many functional programming techniques as I can in C# these days. I use the great \u003ca href=\"https://github.com/louthy/language-ext\"\u003eLanguageExt\u003c/a\u003e library for this. This library is where the \u003ccode\u003eQue\u0026#x3C;T\u003e\u003c/code\u003e, \u003ccode\u003eOption\u0026#x3C;T\u003e\u003c/code\u003e and \u003ccode\u003eLst\u0026#x3C;T\u003e\u003c/code\u003e data structures come from. I don't want to go in depth about what they are, but to understand the code below, you should now this: \u003ccode\u003eQue\u0026#x3C;T\u003e\u003c/code\u003e is an immutable \u003ccode\u003eQueue\u0026#x3C;T\u003e\u003c/code\u003e, \u003ccode\u003eLst\u0026#x3C;T\u003e\u003c/code\u003e is an immutable \u003ccode\u003eList\u0026#x3C;T\u003e\u003c/code\u003e and \u003ccode\u003eOption\u0026#x3C;T\u003e\u003c/code\u003e is basically the functional way to do the null-object pattern (instead of dealing with nulls, use an object to represent \"I don't have a value\").\u003c/p\u003e\n\u003cp\u003eIf you're not familiar with breadth-first tree traversals, it's not too complicated. What we do first is get all the nodes at the top level (in our case, all the nodes that are direct children of the catalog we pass in) and put them in the queue. Then, we iterate through each of the nodes we put in the queue and add their child nodes to the queue. We do this until we run out of nodes to process in the queue which indicates we've gone through all nodes in the tree.\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-csharp\"\u003e\u003ccode class=\"language-csharp\"\u003e\u003cspan class=\"token keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eCatalogSystemNodes\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token type-list\"\u003e\u003cspan class=\"token class-name\"\u003eIEnumerable\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003eCatalogNodeDto\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eCatalogNodeRow\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003eprivate\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eCatalogSystemNodeEnumerator\u003c/span\u003e _enumerator\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"token keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"token function\"\u003eCatalogSystemNodes\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token class-name\"\u003eICatalogSystem\u003c/span\u003e catalogSystem\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token class-name\"\u003e\u003cspan class=\"token keyword\"\u003eint\u003c/span\u003e\u003c/span\u003e catalogId\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token class-name\"\u003e\u003cspan class=\"token keyword\"\u003eint\u003c/span\u003e\u003c/span\u003e startingParentNodeId \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        _enumerator \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"token constructor-invocation class-name\"\u003eCatalogSystemNodeEnumerator\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ecatalogSystem\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e catalogId\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e startingParentNodeId\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"token keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"token return-type class-name\"\u003eIEnumerator\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003eCatalogNodeDto\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eCatalogNodeRow\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token function\"\u003eGetEnumerator\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003e\u003c/span\u003e _enumerator\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"token return-type class-name\"\u003eIEnumerator\u003c/span\u003e IEnumerable\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eGetEnumerator\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003e\u003c/span\u003e _enumerator\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eCatalogSystemNodeEnumerator\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token type-list\"\u003e\u003cspan class=\"token class-name\"\u003eIEnumerator\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003eCatalogNodeDto\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eCatalogNodeRow\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003eprivate\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eQue\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token keyword\"\u003eint\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e _nodeQue\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003eprivate\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eICatalogSystem\u003c/span\u003e _catalogSystem\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003eprivate\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"token class-name\"\u003e\u003cspan class=\"token keyword\"\u003eint\u003c/span\u003e\u003c/span\u003e _catalogId\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003eprivate\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"token class-name\"\u003e\u003cspan class=\"token keyword\"\u003eint\u003c/span\u003e\u003c/span\u003e _startingParentNodeId\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003eprivate\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eOption\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003eCatalogNodeDto\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eCatalogNodeRow\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e _current\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"token comment\"\u003e// We have a parameter for the starting node ID (startingParentNodeId) which defaults to 0.  If you\u003c/span\u003e\n    \u003cspan class=\"token comment\"\u003e// pass in a node ID, we'll start iterating child nodes of that node.  If you don't pass a value (keep\u003c/span\u003e\n    \u003cspan class=\"token comment\"\u003e// the default of 0), then we'll iterate through all nodes in the catalog.\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"token function\"\u003eCatalogSystemNodeEnumerator\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token class-name\"\u003eICatalogSystem\u003c/span\u003e catalogSystem\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token class-name\"\u003e\u003cspan class=\"token keyword\"\u003eint\u003c/span\u003e\u003c/span\u003e catalogId\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token class-name\"\u003e\u003cspan class=\"token keyword\"\u003eint\u003c/span\u003e\u003c/span\u003e startingParentNodeId \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        _catalogSystem \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e catalogSystem\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n        _catalogId \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e catalogId\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n        _startingParentNodeId \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e startingParentNodeId\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n        _nodeQue \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e Prelude\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eQueue\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e_startingParentNodeId\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n        _current \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e Option\u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003eCatalogNodeDto\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eCatalogNodeRow\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eNone\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"token comment\"\u003e// ValueUnsafe() lets us get the value of _current (which is an Option\u0026#x3C;T\u003e)\u003c/span\u003e\n    \u003cspan class=\"token comment\"\u003e// or null if the Option\u0026#x3C;T\u003e has no value.\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"token return-type class-name\"\u003eCatalogNodeDto\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eCatalogNodeRow\u003c/span\u003e Current \u003cspan class=\"token operator\"\u003e=\u003e\u003c/span\u003e _current\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eValueUnsafe\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"token return-type class-name\"\u003e\u003cspan class=\"token keyword\"\u003eobject\u003c/span\u003e\u003c/span\u003e IEnumerator\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eCurrent \u003cspan class=\"token operator\"\u003e=\u003e\u003c/span\u003e Current\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"token keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"token return-type class-name\"\u003e\u003cspan class=\"token keyword\"\u003evoid\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token function\"\u003eDispose\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"token function\"\u003eReset\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"token keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"token return-type class-name\"\u003e\u003cspan class=\"token keyword\"\u003ebool\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token function\"\u003eMoveNext\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"token comment\"\u003e// end-case scenario--we've run out of nodes in the queue, so we're\u003c/span\u003e\n        \u003cspan class=\"token comment\"\u003e// done traversing the node tree\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token operator\"\u003e!\u003c/span\u003e_nodeQue\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eAny\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token boolean\"\u003efalse\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"token class-name\"\u003e\u003cspan class=\"token keyword\"\u003eint\u003c/span\u003e\u003c/span\u003e nextNodeId \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token function\"\u003eGetNextNodeIdAndUpdateQue\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n        \u003cspan class=\"token comment\"\u003e// special starting condition when we want to do the entire tree\u003c/span\u003e\n        \u003cspan class=\"token comment\"\u003e// and no other starting node was passed in\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003enextNodeId \u003cspan class=\"token operator\"\u003e==\u003c/span\u003e \u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"token comment\"\u003e// special case of there being a catalog node with no category nodes beneath it\u003c/span\u003e\n            \u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token operator\"\u003e!\u003c/span\u003e_nodeQue\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eAny\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token boolean\"\u003efalse\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n            nextNodeId \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token function\"\u003eGetNextNodeIdAndUpdateQue\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n        _current \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token function\"\u003eGetNode\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003enextNodeId\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n        \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e _current\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eIsSome\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"token keyword\"\u003eprivate\u003c/span\u003e \u003cspan class=\"token return-type class-name\"\u003e\u003cspan class=\"token keyword\"\u003eint\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token function\"\u003eGetNextNodeIdAndUpdateQue\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"token comment\"\u003e// get the next node ID from the queue\u003c/span\u003e\n        \u003cspan class=\"token class-name\"\u003e\u003cspan class=\"token keyword\"\u003eint\u003c/span\u003e\u003c/span\u003e nextNodeId \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e _nodeQue\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003ePeek\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"token comment\"\u003e// remove the retrieved node from the queue\u003c/span\u003e\n        _nodeQue \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e _nodeQue\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eDequeue\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"token comment\"\u003e// get all of this node's children and add their IDs to the queue\u003c/span\u003e\n        _nodeQue \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token function\"\u003eGetChildren\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003enextNodeId\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eFold\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e_nodeQue\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eq\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e nodeRow\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003e\u003c/span\u003e q\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eEnqueue\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003enodeRow\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eCatalogNodeId\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n        \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e nextNodeId\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"token keyword\"\u003eprivate\u003c/span\u003e \u003cspan class=\"token return-type class-name\"\u003eOption\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003eCatalogNodeDto\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eCatalogNodeRow\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token function\"\u003eGetNode\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token class-name\"\u003e\u003cspan class=\"token keyword\"\u003eint\u003c/span\u003e\u003c/span\u003e nodeId\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"token operator\"\u003e=\u003e\u003c/span\u003e _catalogSystem\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eGetCatalogNodeDto\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003enodeId\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eCatalogNode\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eHeadOrNone\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"token keyword\"\u003eprivate\u003c/span\u003e \u003cspan class=\"token return-type class-name\"\u003eLst\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003eCatalogNodeDto\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eCatalogNodeRow\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token function\"\u003eGetChildren\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token class-name\"\u003e\u003cspan class=\"token keyword\"\u003eint\u003c/span\u003e\u003c/span\u003e nodeId\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"token operator\"\u003e=\u003e\u003c/span\u003e _catalogSystem\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eGetCatalogNodesDto\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e_catalogId\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e nodeId\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eCatalogNode\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eFreeze\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"token keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"token return-type class-name\"\u003e\u003cspan class=\"token keyword\"\u003evoid\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token function\"\u003eReset\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        _nodeQue \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e Prelude\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eQueue\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e_startingParentNodeId\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n        _current \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e Option\u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003eCatalogNodeDto\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eCatalogNodeRow\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eNone\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch3\u003eCatalogSystemEntries Iterator\u003c/h3\u003e\n\u003cp\u003eSince entries cannot be arrange in a nested fashion, this iterator is a little less complicated than the nodes iterator. All we do is take in a catalogId and a catalogNodeId and retrieve all the entries below the given node ID, passing them to you one at a time as you call MoveNext().\u003c/p\u003e\n\u003cp\u003eThe only mildly complex thing here is that we use a \u003ccode\u003eLazy\u0026#x3C;T\u003e\u003c/code\u003e so that we're not retrieving the entries immediately when you instanstiate the IEnumerator. We only load the entries when you MoveNext() and access Current which indicates you really do want some entries.\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-csharp\"\u003e\u003ccode class=\"language-csharp\"\u003e\u003cspan class=\"token keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eCatalogSystemEntries\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token type-list\"\u003e\u003cspan class=\"token class-name\"\u003eIEnumerable\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003eCatalogEntryDto\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eCatalogEntryRow\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003eprivate\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eCatalogSystemEntryEnumerator\u003c/span\u003e _enumerator\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"token keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"token function\"\u003eCatalogSystemEntries\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token class-name\"\u003eICatalogSystem\u003c/span\u003e catalogSystem\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token class-name\"\u003e\u003cspan class=\"token keyword\"\u003eint\u003c/span\u003e\u003c/span\u003e catalogId\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token class-name\"\u003e\u003cspan class=\"token keyword\"\u003eint\u003c/span\u003e\u003c/span\u003e catalogNodeId\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        _enumerator \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"token constructor-invocation class-name\"\u003eCatalogSystemEntryEnumerator\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ecatalogSystem\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e catalogId\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e catalogNodeId\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"token keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"token return-type class-name\"\u003eIEnumerator\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003eCatalogEntryDto\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eCatalogEntryRow\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token function\"\u003eGetEnumerator\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003e\u003c/span\u003e _enumerator\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"token return-type class-name\"\u003eIEnumerator\u003c/span\u003e IEnumerable\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eGetEnumerator\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003e\u003c/span\u003e _enumerator\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eCatalogSystemEntryEnumerator\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token type-list\"\u003e\u003cspan class=\"token class-name\"\u003eIEnumerator\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003eCatalogEntryDto\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eCatalogEntryRow\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003eprivate\u003c/span\u003e \u003cspan class=\"token class-name\"\u003e\u003cspan class=\"token keyword\"\u003eint\u003c/span\u003e\u003c/span\u003e _currentIndex \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003eprivate\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eICatalogSystem\u003c/span\u003e _catalogSystem\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003eprivate\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eLazy\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003eLst\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003eCatalogEntryDto\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eCatalogEntryRow\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e _entries\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003eprivate\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"token class-name\"\u003e\u003cspan class=\"token keyword\"\u003eint\u003c/span\u003e\u003c/span\u003e _catalogNodeId\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003eprivate\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"token class-name\"\u003e\u003cspan class=\"token keyword\"\u003eint\u003c/span\u003e\u003c/span\u003e _catalogId\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"token comment\"\u003e// we take in the catalogNodeId to start at so that you could use this IEnumerator\u003c/span\u003e\n    \u003cspan class=\"token comment\"\u003e// to collect entries at any starting node in the catalog.\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"token function\"\u003eCatalogSystemEntryEnumerator\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token class-name\"\u003eICatalogSystem\u003c/span\u003e catalogSystem\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token class-name\"\u003e\u003cspan class=\"token keyword\"\u003eint\u003c/span\u003e\u003c/span\u003e catalogId\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token class-name\"\u003e\u003cspan class=\"token keyword\"\u003eint\u003c/span\u003e\u003c/span\u003e catalogNodeId\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        _catalogSystem \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e catalogSystem\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"token comment\"\u003e// we use a Lazy\u0026#x3C;T\u003e object here so that we don't do a database call\u003c/span\u003e\n        \u003cspan class=\"token comment\"\u003e// as soon as you instantiate this class.  We only do it once you\u003c/span\u003e\n        \u003cspan class=\"token comment\"\u003e// access Current, indicating you really want to iterate the entries now\u003c/span\u003e\n        _entries \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"token constructor-invocation class-name\"\u003eLazy\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003eLst\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003eCatalogEntryDto\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eCatalogEntryRow\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eGetEntries\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n        _catalogNodeId \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e catalogNodeId\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n        _catalogId \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e catalogId\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"token keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"token return-type class-name\"\u003eCatalogEntryDto\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eCatalogEntryRow\u003c/span\u003e Current\n    \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003eget\u003c/span\u003e\n        \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e _entries\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eValue\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e_currentIndex\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"token return-type class-name\"\u003e\u003cspan class=\"token keyword\"\u003eobject\u003c/span\u003e\u003c/span\u003e IEnumerator\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eCurrent \u003cspan class=\"token operator\"\u003e=\u003e\u003c/span\u003e Current\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"token keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"token return-type class-name\"\u003e\u003cspan class=\"token keyword\"\u003evoid\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token function\"\u003eDispose\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"token function\"\u003eReset\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"token keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"token return-type class-name\"\u003e\u003cspan class=\"token keyword\"\u003ebool\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token function\"\u003eMoveNext\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"token comment\"\u003e// the first MoveNext() call will be when when _entries doesn't have\u003c/span\u003e\n        \u003cspan class=\"token comment\"\u003e// a value yet (but will after Current is accessed).  So, this leaves\u003c/span\u003e\n        \u003cspan class=\"token comment\"\u003e// the _currentIndex at 0 the first time MoveNext() is called.\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e_entries\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eIsValueCreated\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n            _currentIndex\u003cspan class=\"token operator\"\u003e++\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"token comment\"\u003e// we just incremented _currentIndex to the count of the _entries list,\u003c/span\u003e\n        \u003cspan class=\"token comment\"\u003e// so we return false to indicate there are no more values.  We really could\u003c/span\u003e\n        \u003cspan class=\"token comment\"\u003e// use == here instead of \u003e=.  I guess \u003e= feels safer for some reason.\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e_currentIndex \u003cspan class=\"token operator\"\u003e\u003e=\u003c/span\u003e _entries\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eValue\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eCount\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token boolean\"\u003efalse\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token boolean\"\u003etrue\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"token keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"token return-type class-name\"\u003e\u003cspan class=\"token keyword\"\u003evoid\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token function\"\u003eReset\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        _entries \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"token constructor-invocation class-name\"\u003eLazy\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003eLst\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003eCatalogEntryDto\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eCatalogEntryRow\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eGetEntries\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n        _currentIndex \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"token keyword\"\u003eprivate\u003c/span\u003e \u003cspan class=\"token return-type class-name\"\u003eLst\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003eCatalogEntryDto\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eCatalogEntryRow\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token function\"\u003eGetEntries\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"token operator\"\u003e=\u003e\u003c/span\u003e _catalogSystem\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eGetCatalogEntriesDto\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e_catalogId\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e _catalogNodeId\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eCatalogEntry\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eFreeze\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch3\u003eCatalogSystemEntryMetaObjects Iterator\u003c/h3\u003e\n\u003cp\u003eThe MetaObjects iterator is a different than the other iterators in that it doesn't really iterate through a list or tree of MetaObjects. Instead, it iterates through all fo the MetaObject instances for a particular entry--one instance for reach culture available for the catalog.\u003c/p\u003e\n\u003cp\u003eSo, as you'll see in the code below, one of the first things we do is grab all of the languages for the catalog so that we know what we need to interate through.\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-csharp\"\u003e\u003ccode class=\"language-csharp\"\u003e\u003cspan class=\"token keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eCatalogSystemEntryMetaObjects\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token type-list\"\u003e\u003cspan class=\"token class-name\"\u003eIEnumerable\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eMetaObject metaObject\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e MetaDataContext metaDataContext\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003eprivate\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eCatalogSystemEntryMetaObjectsEnumerator\u003c/span\u003e _enumerator\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"token keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"token function\"\u003eCatalogSystemEntryMetaObjects\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token class-name\"\u003eMetaDataContext\u003c/span\u003e metaDataContext\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eCatalogDto\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eCatalogRow\u003c/span\u003e catalog\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eCatalogEntryDto\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eCatalogEntryRow\u003c/span\u003e entry\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        _enumerator \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"token constructor-invocation class-name\"\u003eCatalogSystemEntryMetaObjectsEnumerator\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003emetaDataContext\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e catalog\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e entry\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"token keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"token return-type class-name\"\u003eIEnumerator\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eMetaObject metaObject\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e MetaDataContext metaDataContext\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token function\"\u003eGetEnumerator\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003e\u003c/span\u003e _enumerator\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"token return-type class-name\"\u003eIEnumerator\u003c/span\u003e IEnumerable\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eGetEnumerator\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003e\u003c/span\u003e _enumerator\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eCatalogSystemEntryMetaObjectsEnumerator\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token type-list\"\u003e\u003cspan class=\"token class-name\"\u003eIEnumerator\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eMetaObject metaObject\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e MetaDataContext metaDataContext\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003eprivate\u003c/span\u003e \u003cspan class=\"token class-name\"\u003e\u003cspan class=\"token keyword\"\u003eint\u003c/span\u003e\u003c/span\u003e _currentIndex \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003eprivate\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eCatalogEntryDto\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eCatalogEntryRow\u003c/span\u003e _entry\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003eprivate\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eMetaDataContext\u003c/span\u003e _metaDataContext\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003eprivate\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eLazy\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003eLst\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003eCultureInfo\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e _catalogLanguages\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003eprivate\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ereadonly\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eCatalogDto\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eCatalogRow\u003c/span\u003e _catalog\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"token keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"token function\"\u003eCatalogSystemEntryMetaObjectsEnumerator\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token class-name\"\u003eMetaDataContext\u003c/span\u003e metaDataContext\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"token class-name\"\u003eCatalogDto\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eCatalogRow\u003c/span\u003e catalog\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"token class-name\"\u003eCatalogEntryDto\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eCatalogEntryRow\u003c/span\u003e entry\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        _catalog \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e catalog\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n        _entry \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e entry\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n        _metaDataContext \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e metaDataContext\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n        _catalogLanguages \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"token constructor-invocation class-name\"\u003eLazy\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003eLst\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003eCultureInfo\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eGetCatalogLanguages\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"token keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"token return-type class-name\"\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eMetaObject metaObject\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e MetaDataContext metaDataContext\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003c/span\u003e Current\n    \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003eget\u003c/span\u003e\n        \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"token comment\"\u003e// what we're really iterating through is the catalog languages.\u003c/span\u003e\n            \u003cspan class=\"token comment\"\u003e// as we iterate through them, we grab the associate MetaObject for the current\u003c/span\u003e\n            \u003cspan class=\"token comment\"\u003e// language for the given entry\u003c/span\u003e\n            \u003cspan class=\"token class-name\"\u003eCultureInfo\u003c/span\u003e currentCultureInfo \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e _catalogLanguages\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eValue\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e_currentIndex\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n            \u003cspan class=\"token class-name\"\u003e\u003cspan class=\"token keyword\"\u003evar\u003c/span\u003e\u003c/span\u003e mdc \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e _metaDataContext\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eClone\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n            mdc\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eUseCurrentThreadCulture \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token boolean\"\u003efalse\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n            mdc\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eLanguage \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e currentCultureInfo\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eName\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n            \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eMetaObject\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eLoad\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003emdc\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e _entry\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eCatalogEntryId\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e _entry\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eMetaClassId\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e mdc\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"token return-type class-name\"\u003e\u003cspan class=\"token keyword\"\u003eobject\u003c/span\u003e\u003c/span\u003e IEnumerator\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eCurrent \u003cspan class=\"token operator\"\u003e=\u003e\u003c/span\u003e Current\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"token keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"token return-type class-name\"\u003e\u003cspan class=\"token keyword\"\u003evoid\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token function\"\u003eDispose\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"token function\"\u003eReset\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"token keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"token return-type class-name\"\u003e\u003cspan class=\"token keyword\"\u003ebool\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token function\"\u003eMoveNext\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"token comment\"\u003e// As with the Lazy\u0026#x3C;T\u003e for iterating through the entries, the first tie MoveNext() is called\u003c/span\u003e\n        \u003cspan class=\"token comment\"\u003e// the _catalogLanguages Lazy\u0026#x3C;T\u003e will not have a value.  It will after the first Current access.\u003c/span\u003e\n        \u003cspan class=\"token comment\"\u003e// So, for the first MoveNext(), we want to keep the _currentIndex at 0, which is what this if-statement\u003c/span\u003e\n        \u003cspan class=\"token comment\"\u003e// accomplishes.\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e_catalogLanguages\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eIsValueCreated\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n            _currentIndex\u003cspan class=\"token operator\"\u003e++\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e_currentIndex \u003cspan class=\"token operator\"\u003e\u003e=\u003c/span\u003e _catalogLanguages\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eValue\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eCount\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token boolean\"\u003efalse\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token boolean\"\u003etrue\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"token keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"token return-type class-name\"\u003e\u003cspan class=\"token keyword\"\u003evoid\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token function\"\u003eReset\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        _catalogLanguages \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"token constructor-invocation class-name\"\u003eLazy\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003eLst\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003eCultureInfo\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eGetCatalogLanguages\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n        _currentIndex \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"token keyword\"\u003eprivate\u003c/span\u003e \u003cspan class=\"token return-type class-name\"\u003eLst\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003eCultureInfo\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token function\"\u003eGetCatalogLanguages\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"token operator\"\u003e=\u003e\u003c/span\u003e _catalog\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eGetCatalogLanguageRows\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eMap\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003elr \u003cspan class=\"token operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"token constructor-invocation class-name\"\u003eCultureInfo\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003elr\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eLanguageCode\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eFreeze\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch2\u003eWarning\u003c/h2\u003e\n\u003cp\u003eEven though the above code will give you the convenience of iterating through your entire EPiServer catalog(s), be warned! You could easily forget what the IEnumerators really do above and do something like this:\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-csharp\"\u003e\u003ccode class=\"language-csharp\"\u003e\u003cspan class=\"token comment\"\u003e// REALLY BAD CODE, DON'T DO\u003c/span\u003e\n\u003cspan class=\"token class-name\"\u003eList\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eMetaObject metaObject\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e MetaDataContext mdc\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e allTheMetaObjects \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e _catalogSystem\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eAllCatalogSystemEntryMetaObjects\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003emdc\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eToList\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eI hope you see the danger of this. If you have a large catalog, you're loading the ENTIRE set of MetaObjects into memory in your \u003ccode\u003eallTheMetaObjects\u003c/code\u003e list. This probably won't be good for your application. If you have a small catalog, this might not be a big deal. But, keep this in mind!\u003c/p\u003e\n","date":"2020-05-27T06:00:00Z","slug":"/2020/05/27/iterating-all-catalog-metaobjects"},"__N_SSG":true},"page":"/[...slug]","query":{"slug":["2020","05","27","iterating-all-catalog-metaobjects"]},"buildId":"q_Z7kKqJqS6BT5l45WQTS","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>