<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><meta name="next-head-count" content="2"/><link rel="preload" href="/_next/static/css/37b3f20555b3dcfb.css" as="style"/><link rel="stylesheet" href="/_next/static/css/37b3f20555b3dcfb.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-69bfa6990bb9e155.js" defer=""></script><script src="/_next/static/chunks/framework-e70c6273bfe3f237.js" defer=""></script><script src="/_next/static/chunks/main-4011ba79f13e7457.js" defer=""></script><script src="/_next/static/chunks/pages/_app-ce8c41266b210471.js" defer=""></script><script src="/_next/static/chunks/61-425b38ade8d8eadf.js" defer=""></script><script src="/_next/static/chunks/388-1e496dfd41235e8f.js" defer=""></script><script src="/_next/static/chunks/314-535fae6e035750df.js" defer=""></script><script src="/_next/static/chunks/pages/%5B...slug%5D-f75c9ae4d92bd42c.js" defer=""></script><script src="/_next/static/KQbu6yi4KpAL2XTX_GwZH/_buildManifest.js" defer=""></script><script src="/_next/static/KQbu6yi4KpAL2XTX_GwZH/_ssgManifest.js" defer=""></script><script src="/_next/static/KQbu6yi4KpAL2XTX_GwZH/_middlewareManifest.js" defer=""></script></head><body><div id="__next" data-reactroot=""><div><header><div class="container"><div class="d-flex justify-content-between align-item-center"><a class="d-flex justify-content-start align-items-center mr-2" href="/"><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%2740%27%20height=%2740%27/%3e"/></span><img alt="Gravatar" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="Gravatar" src="https://en.gravatar.com/userimage/738990/32d8e61848233a67f5e02dcc43be0ff8.jpeg" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" loading="lazy"/></noscript></span><span class="ml-2">Ben Ramey&#x27;s Blog</span></a><div class="d-none d-sm-flex flex-column justify-content-around ml-2"><small>Scripture, programming problems, solutions and stories.</small></div></div></div></header><nav class="main"><div class="container d-flex justify-content-center"><a href="/archive/">archive</a><a href="/tags/">tags</a><a href="/categories/">categories</a></div></nav><main><div class="container"><article class="post"><h1 class="post-title">Castle.Windsor TypedFactoryFacility and Unexpected Property Injection Behavior</h1><div class="post-info d-flex justify-content-start"><time dateTime="2016-08-24T06:00:00Z" class="post-date">Wed Aug 24th, 2016<!-- -->, <!-- -->almost 6 years<!-- --> ago</time><nav class="post-tags"><a href="/tags/dotnet/">#<!-- -->dotnet</a><a href="/tags/castle-windsor/">#<!-- -->castle-windsor</a></nav><nav class="post-categories"><span>posted in:</span><a href="/categories/programming/">programming</a></nav></div><div><p>I finally got to the bottom of an issue today that came down to the way Castle.Windsor
does property injection (injecting dependencies into public properties) when
you are also using their TypedFactoryFacility. It was a tough one to track down, so
I thought I'd put the solution out there for everyone else's benefit.</p>
<h2>The Problem</h2>
<p>Here's what the problem looked like.</p>
<h3>The Error Message</h3>
<p>First things first, this is what the symptom looked like:</p>
<div class="remark-highlight"><pre class="language-text"><code class="language-text">[ComponentNotFoundException: No component for supporting the service System.Threading.Tasks.Task was found]
   Castle.MicroKernel.DefaultKernel.Castle.MicroKernel.IKernelInternal.Resolve(Type service, IDictionary arguments, IReleasePolicy policy) +120
   Castle.Facilities.TypedFactory.Internal.TypedFactoryInterceptor.Resolve(IInvocation invocation) +147
   Castle.Facilities.TypedFactory.Internal.TypedFactoryInterceptor.Intercept(IInvocation invocation) +123
   Castle.DynamicProxy.AbstractInvocation.Proceed() +448
   Castle.Proxies.Func`2Proxy.Invoke(OAuthMatchEndpointContext arg) +168

   ...</code></pre></div>
<p>This is actually a pretty standard error when you're using Castle.Windsor. It usually
means Windsor tried to resolve some dependency but discovered that it was missing a
registration. Translation: you forgot to register a component or type in your Windsor
setup. Usually it's an easy fix; just register your dependency properly.</p>
<p>In this case, however, as you can see, the missing registration was of type
System.Threading.Tasks.Task. I didn't have any dependencies on the <code>Task</code> class and so
I didn't want to "fix" any Windsor setup to register it. This wasn't making sense.</p>
<h3>Step One: TypedFactoryInterceptor?</h3>
<p>The first oddity I noticed was that this error was happening somewhere in the flow
of the TypedFactoryInterceptor. I could tell where the error was coming from in my
code (from the rest of the stack trace that I didn't include above). The problem
was that it had nothing to do with any TypedFactoryFacility.</p>
<p>So, I inspected my registrations a little closer. I basically had a setup like this.</p>
<div class="remark-highlight"><pre class="language-csharp"><code class="language-csharp"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ChildClass</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">ParentClass</span></span>
<span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token keyword">override</span> <span class="token return-type class-name">Task</span> <span class="token function">DoSomething</span><span class="token punctuation">(</span><span class="token class-name">Options</span> options<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ParentClass</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IInterface</span></span>
<span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token return-type class-name">Func<span class="token punctuation">&#x3C;</span>Options<span class="token punctuation">,</span> Task<span class="token punctuation">></span></span> OnDoSomething <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
  <span class="token keyword">public</span> <span class="token return-type class-name">Func<span class="token punctuation">&#x3C;</span>Options<span class="token punctuation">,</span> Task<span class="token punctuation">></span></span> OnDoSomethingElse <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

  <span class="token keyword">public</span> <span class="token keyword">virtual</span> <span class="token return-type class-name">Task</span> <span class="token function">DoSomething</span><span class="token punctuation">(</span><span class="token class-name">Options</span> options<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">OnDoSomething</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">public</span> <span class="token keyword">virtual</span> <span class="token return-type class-name">Task</span> <span class="token function">DoSomethingElse</span><span class="token punctuation">(</span><span class="token class-name">Options</span> options<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">return</span> OnDoSomethingElse<span class="token punctuation">.</span><span class="token function">Invoke</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div>
<p>Notice a couple of things.</p>
<ol>
<li>ParentClass has several virtual methods. I'm only overriding one.</li>
<li>ParentClass is setup to allow you to override the virtual methods or to just supply
it with Funcs.</li>
<li>The implementation of the virtual methods is to simply call the corresponding Funcs.</li>
</ol>
<h3>Finding the Location of the Problem</h3>
<p>After lots of testing and debugging, I finally figured out that somehow a FuncProxy
(see line 6 in the error stack trace above) was being injected into all of the
public <code>Func&#x3C;,></code> properties on ParentClass. Then, when methods were called that
I did not override in my ChildClass, the Func would be called in the ParentClass
and that's where Windsor was hooking in and eventually causing an error when it
eventually tried to resolve a dependency on <code>Task</code>.</p>
<h3>One More Clue</h3>
<p>As I mentioned above, the presence of a TypedFactoryInterceptor in the stack trace
was strange to me. I wasn't using Windor's TypedFactoryFacility to register my ChildClass.
So, why was it sticking its nose into my class somehow?</p>
<p>I did some simple debugging and turned off the TypedFactoryFacility in my Windsor setup.
Just like magic,
the error I was seeing went away. So, my conclusion: somehow TypedFactoryFacility was
inserting itself into my ChildClass registration and injecting <code>FuncProxy</code>s into the
ParentClass public <code>Func&#x3C;,></code> properties.</p>
<h2>The Solution</h2>
<p>This looked an aweful lot like property injection to me. I started searching related to
TypedFactoryFacility and property injection. I pretty quickly came upon this documentation:
<a href="https://github.com/castleproject/Windsor/blob/master/docs/how-properties-are-injected.md">https://github.com/castleproject/Windsor/blob/master/docs/how-properties-are-injected.md</a>.</p>
<p>That page describes how Windsor does property injection, which I actually thought was
an opt-in feature of Windsor. In fact, Windsor does it by default, as describe on that page.</p>
<p>Combining this revelation (to me) with the fact that TypedFactoryFacility also allows you
to take a dependency on a simple <code>Func</code> and turn it into a factory call into your Windsor
container, I concluded that, by turning on the TypedFactoryFacility in Windsor, I was opening
up public properties that had <code>Func&#x3C;></code> types to property injection by Windsor.</p>
<p>Now, I hate property injection, so I was fine with just turning it off completely. Luckily,
the documentation link above also included instructions how to do it. I've included that code
here.</p>
<div class="remark-highlight"><pre class="language-csharp"><code class="language-csharp"><span class="token class-name"><span class="token keyword">var</span></span> propInjector <span class="token operator">=</span> Kernel<span class="token punctuation">.</span>ComponentModelBuilder
                         <span class="token punctuation">.</span>Contributors
                         <span class="token punctuation">.</span><span class="token generic-method"><span class="token function">OfType</span><span class="token generic class-name"><span class="token punctuation">&#x3C;</span>PropertiesDependenciesModelInspector<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                         <span class="token punctuation">.</span><span class="token function">Single</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Kernel<span class="token punctuation">.</span>ComponentModelBuilder<span class="token punctuation">.</span><span class="token function">RemoveContributor</span><span class="token punctuation">(</span>propInjector<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
<p>I added this code into my Windsor container setup and tried again. Everything worked just
as expected.</p>
<h2>Lessons Learned</h2>
<p>A couple of quick takeaways:</p>
<ol>
<li>Windsor does property injection by default. Check out the documentation link above for
the criteria it uses to determine when it should or not.</li>
<li>Using TypedFactoryFacility is fantastic, but turn off property injection if you have
public <code>Func&#x3C;></code> properties anywhere.</li>
</ol>
</div></article><section class="comments"><a id="comments-section"><h2>Comments</h2></a><div id="disqus_thread"></div></section></div></main><footer class="footer"><div class="container"><hr/><small>© <time dateTime="2022-06-29T00:01:35.699Z">2022</time>. All rights reserved.</small></div><script async="" defer="" data-website-id="b5832ded-a501-4aab-b4ce-ef0373a1a887" src="https://umami.benramey.com/umami.js"></script></footer></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"tags":["dotnet","castle-windsor"],"categories":["programming"],"title":"Castle.Windsor TypedFactoryFacility and Unexpected Property Injection Behavior","contentHtml":"\u003cp\u003eI finally got to the bottom of an issue today that came down to the way Castle.Windsor\ndoes property injection (injecting dependencies into public properties) when\nyou are also using their TypedFactoryFacility. It was a tough one to track down, so\nI thought I'd put the solution out there for everyone else's benefit.\u003c/p\u003e\n\u003ch2\u003eThe Problem\u003c/h2\u003e\n\u003cp\u003eHere's what the problem looked like.\u003c/p\u003e\n\u003ch3\u003eThe Error Message\u003c/h3\u003e\n\u003cp\u003eFirst things first, this is what the symptom looked like:\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-text\"\u003e\u003ccode class=\"language-text\"\u003e[ComponentNotFoundException: No component for supporting the service System.Threading.Tasks.Task was found]\n   Castle.MicroKernel.DefaultKernel.Castle.MicroKernel.IKernelInternal.Resolve(Type service, IDictionary arguments, IReleasePolicy policy) +120\n   Castle.Facilities.TypedFactory.Internal.TypedFactoryInterceptor.Resolve(IInvocation invocation) +147\n   Castle.Facilities.TypedFactory.Internal.TypedFactoryInterceptor.Intercept(IInvocation invocation) +123\n   Castle.DynamicProxy.AbstractInvocation.Proceed() +448\n   Castle.Proxies.Func`2Proxy.Invoke(OAuthMatchEndpointContext arg) +168\n\n   ...\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThis is actually a pretty standard error when you're using Castle.Windsor. It usually\nmeans Windsor tried to resolve some dependency but discovered that it was missing a\nregistration. Translation: you forgot to register a component or type in your Windsor\nsetup. Usually it's an easy fix; just register your dependency properly.\u003c/p\u003e\n\u003cp\u003eIn this case, however, as you can see, the missing registration was of type\nSystem.Threading.Tasks.Task. I didn't have any dependencies on the \u003ccode\u003eTask\u003c/code\u003e class and so\nI didn't want to \"fix\" any Windsor setup to register it. This wasn't making sense.\u003c/p\u003e\n\u003ch3\u003eStep One: TypedFactoryInterceptor?\u003c/h3\u003e\n\u003cp\u003eThe first oddity I noticed was that this error was happening somewhere in the flow\nof the TypedFactoryInterceptor. I could tell where the error was coming from in my\ncode (from the rest of the stack trace that I didn't include above). The problem\nwas that it had nothing to do with any TypedFactoryFacility.\u003c/p\u003e\n\u003cp\u003eSo, I inspected my registrations a little closer. I basically had a setup like this.\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-csharp\"\u003e\u003ccode class=\"language-csharp\"\u003e\u003cspan class=\"token keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eChildClass\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token type-list\"\u003e\u003cspan class=\"token class-name\"\u003eParentClass\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eoverride\u003c/span\u003e \u003cspan class=\"token return-type class-name\"\u003eTask\u003c/span\u003e \u003cspan class=\"token function\"\u003eDoSomething\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token class-name\"\u003eOptions\u003c/span\u003e options\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token range operator\"\u003e..\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eParentClass\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token type-list\"\u003e\u003cspan class=\"token class-name\"\u003eIInterface\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"token return-type class-name\"\u003eFunc\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003eOptions\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e Task\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e OnDoSomething \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eget\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eset\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"token return-type class-name\"\u003eFunc\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003eOptions\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e Task\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e OnDoSomethingElse \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eget\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eset\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n  \u003cspan class=\"token keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"token keyword\"\u003evirtual\u003c/span\u003e \u003cspan class=\"token return-type class-name\"\u003eTask\u003c/span\u003e \u003cspan class=\"token function\"\u003eDoSomething\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token class-name\"\u003eOptions\u003c/span\u003e options\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token function\"\u003eOnDoSomething\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eoptions\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n  \u003cspan class=\"token keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"token keyword\"\u003evirtual\u003c/span\u003e \u003cspan class=\"token return-type class-name\"\u003eTask\u003c/span\u003e \u003cspan class=\"token function\"\u003eDoSomethingElse\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token class-name\"\u003eOptions\u003c/span\u003e options\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e OnDoSomethingElse\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eInvoke\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eoptions\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eNotice a couple of things.\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eParentClass has several virtual methods. I'm only overriding one.\u003c/li\u003e\n\u003cli\u003eParentClass is setup to allow you to override the virtual methods or to just supply\nit with Funcs.\u003c/li\u003e\n\u003cli\u003eThe implementation of the virtual methods is to simply call the corresponding Funcs.\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch3\u003eFinding the Location of the Problem\u003c/h3\u003e\n\u003cp\u003eAfter lots of testing and debugging, I finally figured out that somehow a FuncProxy\n(see line 6 in the error stack trace above) was being injected into all of the\npublic \u003ccode\u003eFunc\u0026#x3C;,\u003e\u003c/code\u003e properties on ParentClass. Then, when methods were called that\nI did not override in my ChildClass, the Func would be called in the ParentClass\nand that's where Windsor was hooking in and eventually causing an error when it\neventually tried to resolve a dependency on \u003ccode\u003eTask\u003c/code\u003e.\u003c/p\u003e\n\u003ch3\u003eOne More Clue\u003c/h3\u003e\n\u003cp\u003eAs I mentioned above, the presence of a TypedFactoryInterceptor in the stack trace\nwas strange to me. I wasn't using Windor's TypedFactoryFacility to register my ChildClass.\nSo, why was it sticking its nose into my class somehow?\u003c/p\u003e\n\u003cp\u003eI did some simple debugging and turned off the TypedFactoryFacility in my Windsor setup.\nJust like magic,\nthe error I was seeing went away. So, my conclusion: somehow TypedFactoryFacility was\ninserting itself into my ChildClass registration and injecting \u003ccode\u003eFuncProxy\u003c/code\u003es into the\nParentClass public \u003ccode\u003eFunc\u0026#x3C;,\u003e\u003c/code\u003e properties.\u003c/p\u003e\n\u003ch2\u003eThe Solution\u003c/h2\u003e\n\u003cp\u003eThis looked an aweful lot like property injection to me. I started searching related to\nTypedFactoryFacility and property injection. I pretty quickly came upon this documentation:\n\u003ca href=\"https://github.com/castleproject/Windsor/blob/master/docs/how-properties-are-injected.md\"\u003ehttps://github.com/castleproject/Windsor/blob/master/docs/how-properties-are-injected.md\u003c/a\u003e.\u003c/p\u003e\n\u003cp\u003eThat page describes how Windsor does property injection, which I actually thought was\nan opt-in feature of Windsor. In fact, Windsor does it by default, as describe on that page.\u003c/p\u003e\n\u003cp\u003eCombining this revelation (to me) with the fact that TypedFactoryFacility also allows you\nto take a dependency on a simple \u003ccode\u003eFunc\u003c/code\u003e and turn it into a factory call into your Windsor\ncontainer, I concluded that, by turning on the TypedFactoryFacility in Windsor, I was opening\nup public properties that had \u003ccode\u003eFunc\u0026#x3C;\u003e\u003c/code\u003e types to property injection by Windsor.\u003c/p\u003e\n\u003cp\u003eNow, I hate property injection, so I was fine with just turning it off completely. Luckily,\nthe documentation link above also included instructions how to do it. I've included that code\nhere.\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-csharp\"\u003e\u003ccode class=\"language-csharp\"\u003e\u003cspan class=\"token class-name\"\u003e\u003cspan class=\"token keyword\"\u003evar\u003c/span\u003e\u003c/span\u003e propInjector \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e Kernel\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eComponentModelBuilder\n                         \u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eContributors\n                         \u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token generic-method\"\u003e\u003cspan class=\"token function\"\u003eOfType\u003c/span\u003e\u003cspan class=\"token generic class-name\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003ePropertiesDependenciesModelInspector\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n                         \u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eSingle\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\nKernel\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eComponentModelBuilder\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eRemoveContributor\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003epropInjector\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eI added this code into my Windsor container setup and tried again. Everything worked just\nas expected.\u003c/p\u003e\n\u003ch2\u003eLessons Learned\u003c/h2\u003e\n\u003cp\u003eA couple of quick takeaways:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eWindsor does property injection by default. Check out the documentation link above for\nthe criteria it uses to determine when it should or not.\u003c/li\u003e\n\u003cli\u003eUsing TypedFactoryFacility is fantastic, but turn off property injection if you have\npublic \u003ccode\u003eFunc\u0026#x3C;\u003e\u003c/code\u003e properties anywhere.\u003c/li\u003e\n\u003c/ol\u003e\n","date":"2016-08-24T06:00:00Z","slug":"/2016/08/24/castle-windsor-typedfactoryfacility-and-property-injection"},"__N_SSG":true},"page":"/[...slug]","query":{"slug":["2016","08","24","castle-windsor-typedfactoryfacility-and-property-injection"]},"buildId":"KQbu6yi4KpAL2XTX_GwZH","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>