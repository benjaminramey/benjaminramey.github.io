<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <title>
        
        You Can't Subscribe to IEvent with NServiceBus &middot; Ben Ramey's Blog
        
    </title>

    <link rel="stylesheet" href="/assets/css/styles.css">

    <link rel="apple-touch-icon" sizes="180x180" href="">
    <link rel="icon" type="image/png" sizes="32x32" href="">
    <link rel="icon" type="image/png" sizes="16x16" href="">
    <link rel="manifest" href="">

    <link rel="alternate" type="application/atom+xml" title="Ben Ramey's Blog" href="/atom.xml">

    <!-- Begin Jekyll SEO tag v2.6.1 -->
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="You Can’t Subscribe to IEvent with NServiceBus" />
<meta name="author" content="Ben Ramey" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="The problems with trying to subscribe to IEvent with NServiceBus" />
<meta property="og:description" content="The problems with trying to subscribe to IEvent with NServiceBus" />
<link rel="canonical" href="https://www.benramey.com/2016/02/25/you-cant-subscribe-to-ievent-with-nservicebus/" />
<meta property="og:url" content="https://www.benramey.com/2016/02/25/you-cant-subscribe-to-ievent-with-nservicebus/" />
<meta property="og:site_name" content="Ben Ramey’s Blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2016-02-25T09:56:00-06:00" />
<script type="application/ld+json">
{"@type":"BlogPosting","dateModified":"2016-02-25T09:56:00-06:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://www.benramey.com/2016/02/25/you-cant-subscribe-to-ievent-with-nservicebus/"},"url":"https://www.benramey.com/2016/02/25/you-cant-subscribe-to-ievent-with-nservicebus/","author":{"@type":"Person","name":"Ben Ramey"},"headline":"You Can’t Subscribe to IEvent with NServiceBus","description":"The problems with trying to subscribe to IEvent with NServiceBus","datePublished":"2016-02-25T09:56:00-06:00","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

</head>


<body>
    <header>
        <div class="container">
            <div class="d-flex justify-content-between align-item-center">
                <a href="/" class="d-flex justify-content-start align-items-center mr-2" title="Home">
                    <img src="https://en.gravatar.com/userimage/738990/32d8e61848233a67f5e02dcc43be0ff8.jpeg"
                        alt="Gravatar" />
                    <span class="ml-2">Ben Ramey's Blog</span>
                </a>
                <div class="d-none d-sm-flex flex-column justify-content-around ml-2">
                    <small>Scripture, programming problems, solutions and stories.</small>
                </div>
            </div>
        </div>
    </header>

    <nav class="main">
        <div class="container d-flex justify-content-center">
            
            
            
            
            
            
            
            <a href="/archive/">Archive</a>
            
            
            
            
            
            
            
            <a href="/categories/">Categories</a>
            
            
            
            
            
            
            
            
            
            <a href="/tags/">Tags</a>
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
        </div>
    </nav>

    <main>
        <div class="container">
            <article class="post">
    <h1 class="post-title">You Can't Subscribe to IEvent with NServiceBus</h1>
    <div class="post-info d-flex justify-content-start">
        <time datetime="2016-02-25T09:56:00-06:00" class="post-date">25 Feb 2016</time>
        <nav class="post-tags">
            
            <a href="/tags/.net">#.net</a>
            
            <a href="/tags/nservicebus">#nservicebus</a>
            
        </nav>
        <nav class="post-categories">
            <span>posted in:</span>
            
            <a href="/categories/programming">programming</a>
            
        </nav>
    </div>
    <p>The reason you might want to subscribe to <code class="highlighter-rouge">IEvent</code> is pretty straightforward. I
wanted to do it for the simple reason of wanting to be able to choose (based
on configuration) whether I wanted to notify anyone of any event that
could be published on my bus.</p>

<p>In other words, whenever an event of any type was published, I wanted one particular
endpoint to subscribe to that event and then decide whether it should do
anything with it.</p>

<p>I thought the code to do that should be pretty simple.  Since all published
events <em>should</em> implement the <code class="highlighter-rouge">IEvent</code> interface and NServiceBus supports
polymorphism in its message handling, creating a message handler that
implemented <code class="highlighter-rouge">IHandleMessages&lt;IEvent&gt;</code> should be all I should have needed!</p>

<p>I was testing this with only partial success and so I thought it was working.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>public class EventHandler : IHandleMessages&lt;IEvent&gt;
{
   public void Handle(IEvent message)
   {
     ...
   }
}
</code></pre></div></div>

<h2 id="my-partial-success">My Partial Success</h2>
<p>The reason I had partial success was because I was also <em>explicitly</em> handling
other events in the same endpoint on a special saga I had setup.  So, when
the endpoint started up, it would subscribe to these events.  At first, I only
wanted to send notifications for these events anyway, so it all seemed to be
working.  My special <code class="highlighter-rouge">IEvent</code> would work because the <code class="highlighter-rouge">Saga</code> subscribed this same
endpoint to those few events explicitly.</p>

<h2 id="my-full-failure">My Full Failure</h2>
<p>I realized I had only partially succeeded when I started wanting to send notifications
for other events that were not in that <code class="highlighter-rouge">Saga</code>.  I dug into the issue for a few
hours and finally began to wonder if NServiceBus (or maybe the RabbitMQ transport)
was explicitly ignoring <code class="highlighter-rouge">IEvent</code> when it setup subscriptions.</p>

<p>Sure enough, it does.</p>

<p>To build a list of types to subscribe to, NServiceBus uses the <code class="highlighter-rouge">Conventions</code>
class in the <code class="highlighter-rouge">NServiceBus.Core</code> namespace.  One of the checks that code does
is to filter the list of potential types with the <code class="highlighter-rouge">IsEventType</code> method.  This
method checks if the <code class="highlighter-rouge">Type</code> is in a Particular (NServiceBus) DLL.  See the
code here: <a href="https://github.com/Particular/NServiceBus/blob/e4bc405509e3b9c3fc91e21a56333bb40ac54a60/src/NServiceBus.Core/Conventions.cs#L154">IsEventType</a></p>

<h2 id="my-solution">My Solution</h2>
<p>The solution is simple enough.  Instead of listening to <code class="highlighter-rouge">IEvent</code>, listen
to a custom interface that you implement on all of your events.  This is probably
more close to what you are trying to do anyway–listen to all events that your
system produces.</p>

<p>So, I simply created a marker interface called <code class="highlighter-rouge">ICustomEvent</code>.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>public interface ICustomEvent : IEvent { }
</code></pre></div></div>

<p>Then, on all of my bus event classes, instead of implementing <code class="highlighter-rouge">IEvent</code> directly,
I implemented <code class="highlighter-rouge">ICustomEvent</code>.</p>

<p>My handler then looked like this.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>public class EventHandler : IHandleMessages&lt;ICustomEvent&gt;
{
   public void Handle(ICustomEvent message)
   {
     ...
   }
}
</code></pre></div></div>

<p>Now, the right subscriptions are all set up and my single handler gets
every single event published by my entire bus.</p>

</article>

<!-- Disqus comments -->

<section class="comments">
    <h2>Comments</h2>
    <div id="disqus_thread"></div>
<script>
    var disqus_config = function () {
        this.page.url = 'https://www.benramey.com/2016/02/25/you-cant-subscribe-to-ievent-with-nservicebus/';
        this.page.identifier = '/2016/02/25/you-cant-subscribe-to-ievent-with-nservicebus';
        this.page.title = 'You Can't Subscribe to IEvent with NServiceBus';
    };

    (function() { // DON'T EDIT BELOW THIS LINE
    var d = document, s = d.createElement('script');
    s.src = 'https://fishybusiness.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
                            
</section>



<section class="related">
    <h2>Related posts</h2>
    <ul class="related-posts">
        
        <li>
            <a href="/2020/05/12/psalm-130/">
                Psalm 130
                <small><time
                        datetime="2020-05-12T00:00:00-05:00">12 May 2020</time></small>
            </a>
        </li>
        
        <li>
            <a href="/2017/01/20/I-Like-Languages-That-Expect-Me-To-Be-a-Great-Programmer/">
                I Like Languages That Expect Me To Be a Great Programmer
                <small><time
                        datetime="2017-01-20T14:05:00-06:00">20 Jan 2017</time></small>
            </a>
        </li>
        
        <li>
            <a href="/2016/08/24/castle-windsor-typedfactoryfacility-and-property-injection/">
                Castle.Windsor TypedFactoryFacility and Unexpected Property Injection Behavior
                <small><time
                        datetime="2016-08-24T07:37:00-05:00">24 Aug 2016</time></small>
            </a>
        </li>
        
    </ul>
    </aside>
    

        </div>
    </main>

    <footer class="footer">
        <div class="container">
            <small>
                &copy; <time datetime="2020-05-13T16:33:35-05:00">2020</time>. All
                rights reserved.
            </small>
        </div>
    </footer>

    <!-- <script>
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

	ga('create', 'UA-1380501-7', 'auto');
	ga('send', 'pageview');
</script> -->
<script>var clicky_site_ids = clicky_site_ids || []; clicky_site_ids.push(101254860);</script>
<script async src="//static.getclicky.com/js"></script>

</body>

</html>
